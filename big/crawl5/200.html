<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
<title>Configuring Impala and MapReduce for Multi-tenant Performance | Cloudera Developer Blog</title>

<meta name="keywords" content="hadoop, hadoop training, cloudera, hadoop tutorial, hadoop certification, apache hadoop, hadoop download, big data, open source" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="msvalidate.01" content="8857B9071A02F989DE3F8BEE557BB584" />

<link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Cloudera" />

<meta property="og:title" content="Configuring Impala and MapReduce for Multi-tenant Performance"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://blog.cloudera.com/blog/2013/06/configuring-impala-and-mapreduce-for-multi-tenant-performance/"/>
<meta property="og:site_name" content="Cloudera Developer Blog"/>


<link rel="icon" href="/wp-content/themes/solutionset/assets/favicon.ico" type="image/x-icon" /> 
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/960.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/reset.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/all.css?20120620" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/wp.css?20120620" /> 

<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 8]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6-7.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 9]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie.css?20120605" media="screen"/><![endif]-->

<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/modernizr-2.6.1.min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4.4-more-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript"> jQuery.noConflict(); </script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery.colorbox-min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/global.js?20120605"></script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "ur-aa86c136-1042-b30d-950-dd905bb179a0", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>


<link rel="pingback" href="http://blog.cloudera.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Feed" href="http://blog.cloudera.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Comments Feed" href="http://blog.cloudera.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Configuring Impala and MapReduce for Multi-tenant Performance Comments Feed" href="http://blog.cloudera.com/blog/2013/06/configuring-impala-and-mapreduce-for-multi-tenant-performance/feed/" />
<link rel='stylesheet' id='prettify-gc-syntax-highlighter-css'  href='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='cptchStylesheet-css'  href='http://blog.cloudera.com/wp-content/plugins/captcha/css/style_wp_before_3.8.css?ver=3.3.2' type='text/css' media='all' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.cloudera.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.cloudera.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Customer Spotlight: Embracing Big Data Innovations at The Cloudera Forum' href='http://blog.cloudera.com/blog/2013/06/customer-spotlight-embracing-big-data-innovations-at-the-cloudera-forum/' />
<link rel='next' title='What’s Next for HBase? Big Data Applications Using Frameworks Like Kiji' href='http://blog.cloudera.com/blog/2013/06/whats-next-for-hbase-big-data-applications-using-frameworks-like-kiji/' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='http://blog.cloudera.com/blog/2013/06/configuring-impala-and-mapreduce-for-multi-tenant-performance/' />
<link rel='shortlink' href='http://blog.cloudera.com/?p=22105' />


<script type="text/javascript">
 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-2275969-16']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();
</script>


</head>
<body class="single single-post postid-22105 single-format-standard devcenter">
			
		
			
	<header id="site-head">
<nav class="properties">
            <div class="container">
                <ul>
                    <!--<li><a href="http://www.cloudera.com">Cloudera.com</a></li>-->
                     <!--<li><a href="http://university.cloudera.com">Cloudera University</a></li>
                   <li><a href="${config.LINK_CCP}/display/DOC/Documentation">Documentation</a></li>-->
                    <li><a id="support_home_page" href="http://cloudera.com/content/support/en/home.html" class="active">Support</a></li>
                    <li><a href="http://cloudera.com/content/dev-center/en/home.html">Developers</a></li>
                  <!--<li><a href="http://cloudera.com/content/cloudera/en/partners.html">PARTNERS</a></li>-->
                   
                </ul>
                <ul class="user">
                    <li>
                       <!--<a id="signinLink" class="hidden" href="https://clouderapkb.echolane.cs3.force.com/idp/login?app=0spQ00000004CD5">Sign In</a>-->
<a id="signinLink" class="hidden" href="https://cloudera.secure.force.com">Sign In</a>
                    </li>
                    <li><a id="registerLink" class="hidden" href="http://cloudera.com/content/support/en/user-registration.html">Register</a></li>
                    <li><a href="http://cloudera.com/content/cloudera/en/about/contact-us.html">Contact Us</a></li>
                    <li><a href="http://cloudera.com/content/support/en/downloads.html">Downloads</a></li>
                    <li>
                        <div id="dropdownAction" class="dropdown" style="display:none">
                            <a id="lnkDropdowntoogle" data-toggle="dropdown" class="dropdown-toggle" href="#">

                            </a>
                            <ul aria-labelledby="dropdownMenu" tole="menu" class="dropdown-menu">
                                <li><a href="http://cloudera.com/content/support/en/edit-user-profile.html" id="editProfileLink" tabindex="-1">Edit Profile</a></li>
                                <li class="divider"></li>
                                <li>
                                <a id="logoutLink" tabindex="-1" href="#">Logout</a>
                                </script>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="bg-fix"></div>
        </nav>
<!--</div>-->

<div class="wrapper">
    <div class="bg-fix"></div>
    <h1 class="logo">
        <a href="http://cloudera.com/content/cloudera/en/home.html">Cloudera</a>
    </h1>

<nav class="site">
        <ul>
    <li class="">
 <a href="http://community.cloudera.com" data-link="external">Community</a>
</li>
<li class="">
 <a href="http://cloudera.com/content/support/en/documentation.html" data-link="external">Documentation</a>
</li>
 <li class="">
                    <a href="http://cloudera.com/content/support/en/downloads.html" data-link="external">Downloads</a>
   </li>
     <li class="">
                    <a href="http://university.cloudera.com" data-link="external">Training</a>
     </li>
<li class="">
                    <a href="http://blog.cloudera.com" data-link="external" class="active">Blogs</a>
                    <nav class="subnav menu"> <nav><ul>
<li><a href="http://vision.cloudera.com">Cloudera Vision</a></li>
<!--<li><a href="http://blog.cloudera.com/blog">Developer Blog</a></li>-->
</ul>
</nav> </nav>
</li>
            
        </ul>
    </nav>


    <div class="form-holder">
		
	    <form action="http://cloudera.com/content/cloudera/en/search.html" id="site-search" method="get" novalidate> 
	        <label for="q" class="visuallyhidden">Search</label> 
	        <input type="search" name="q" id="q" placeholder="Search"><i class="icon-search"></i> 
	    </form>
    </div>
    </div><!--</div>-->
        </header>
				
	<div role="main" class="main">
		<div class="wrapper">
			<section class="two-col">

	
<aside class="left-col">

				<nav>
			<ul class=" ">
			
								
							<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/hadoop-and-big-data.html"
					title="Hadoop &amp; Big Data"
					class=""
					target="_blank"				>
					Hadoop &amp; Big Data				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/our-customers.html"
					title="Our Customers"
					class=""
					target="_blank"				>
					Our Customers				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/faqs.html"
					title="FAQs"
					class=""
					target="_blank"				>
					FAQs				</a>

							</li>
			
					<li class="current">
				<a
					href="/blog/"
					title="Blog"
					class="blog"
									>
					Blog				</a>

									<ul>
									<li class="">
				<a
					href="/blog/category/accumulo/"
					title="Accumulo (1)"
					class=""
									>
					Accumulo (1)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/avro/"
					title="Avro (16)"
					class=""
									>
					Avro (16)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/bigtop/"
					title="Bigtop (6)"
					class=""
									>
					Bigtop (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/books/"
					title="Books (6)"
					class=""
									>
					Books (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/careers/"
					title="Careers (14)"
					class=""
									>
					Careers (14)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cdh/"
					title="CDH (127)"
					class=""
									>
					CDH (127)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloud-2/"
					title="Cloud (9)"
					class=""
									>
					Cloud (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-life/"
					title="Cloudera Life (3)"
					class=""
									>
					Cloudera Life (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-manager/"
					title="Cloudera Manager (61)"
					class=""
									>
					Cloudera Manager (61)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/community/"
					title="Community (182)"
					class=""
									>
					Community (182)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-collection/"
					title="Data Collection (17)"
					class=""
									>
					Data Collection (17)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-science/"
					title="Data Science (26)"
					class=""
									>
					Data Science (26)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/distribution/"
					title="Distribution (36)"
					class=""
									>
					Distribution (36)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/events/"
					title="Events (37)"
					class=""
									>
					Events (37)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/flume/"
					title="Flume (18)"
					class=""
									>
					Flume (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/general/"
					title="General (327)"
					class=""
									>
					General (327)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/guest/"
					title="Guest (77)"
					class=""
									>
					Guest (77)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hadoop/"
					title="Hadoop (293)"
					class=""
									>
					Hadoop (293)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hardware/"
					title="Hardware (3)"
					class=""
									>
					Hardware (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hbase/"
					title="HBase (124)"
					class=""
									>
					HBase (124)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hdfs/"
					title="HDFS (45)"
					class=""
									>
					HDFS (45)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hive/"
					title="Hive (62)"
					class=""
									>
					Hive (62)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/how-to/"
					title="How-to (53)"
					class=""
									>
					How-to (53)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hue/"
					title="Hue (30)"
					class=""
									>
					Hue (30)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/impala/"
					title="Impala (63)"
					class=""
									>
					Impala (63)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/kite-sdk/"
					title="Kite SDK (11)"
					class=""
									>
					Kite SDK (11)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mahout-2/"
					title="Mahout (5)"
					class=""
									>
					Mahout (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mapreduce/"
					title="MapReduce (71)"
					class=""
									>
					MapReduce (71)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/meet-the-engineer/"
					title="Meet The Engineer (18)"
					class=""
									>
					Meet The Engineer (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/oozie/"
					title="Oozie (25)"
					class=""
									>
					Oozie (25)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/ops/"
					title="Ops And DevOps (19)"
					class=""
									>
					Ops And DevOps (19)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/pig/"
					title="Pig (35)"
					class=""
									>
					Pig (35)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/quickstart-vm/"
					title="QuickStart VM (5)"
					class=""
									>
					QuickStart VM (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/search/"
					title="Search (21)"
					class=""
									>
					Search (21)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/security-2/"
					title="Security (15)"
					class=""
									>
					Security (15)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/spark/"
					title="Spark (9)"
					class=""
									>
					Spark (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/sqoop/"
					title="Sqoop (20)"
					class=""
									>
					Sqoop (20)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/support/"
					title="Support (4)"
					class=""
									>
					Support (4)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/testing/"
					title="Testing (8)"
					class=""
									>
					Testing (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/this-month-in-the-ecosystem/"
					title="This Month In The Ecosystem (8)"
					class=""
									>
					This Month In The Ecosystem (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/tools/"
					title="Tools (6)"
					class=""
									>
					Tools (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/training-2/"
					title="Training (42)"
					class=""
									>
					Training (42)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/use-case/"
					title="Use Case (59)"
					class=""
									>
					Use Case (59)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/whirr/"
					title="Whirr (6)"
					class=""
									>
					Whirr (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/yarn/"
					title="YARN (12)"
					class=""
									>
					YARN (12)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/zookeeper/"
					title="ZooKeeper (24)"
					class=""
									>
					ZooKeeper (24)				</a>

							</li>
			
					<li class="">
				<a
					href="/archive/"
					title="Archives by Month"
					class=""
									>
					Archives by Month				</a>

							</li>
			
							</ul>
							</li>
			
						
			    
			
				<div style="clear:both"></div>
			</ul>
			</nav>
			<div class="menu-special">
				<ul>
							
				
				
		
				
		
				
				
				
				

		
					</ul>
			</div>
			
</aside>


<section>
			<h1 class="heading ">Configuring Impala and MapReduce for Multi-tenant Performance</h1>
			
			<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
			
			<ul class="post-info">
				<li>by Yanpei Chen, Prashant Gokhale, and Arun Singla</li>
				<li>June 10, 2013</li>
				<li class="comment"><a href="#comments">no comments</a></li>
				
			</ul>
			
			<div class="text-block">
				<p><a href="http://blog.cloudera.com/blog/2013/05/cloudera-impala-1-0-its-here-its-real-its-already-the-standard-for-sql-on-hadoop/">Cloudera Impala</a> has many exciting features, but one of the most impressive is the ability to analyze data in multiple formats, with no ETL needed, in HDFS and Apache HBase. Furthermore, you can use multiple frameworks, such as MapReduce and Impala, to analyze that same data. Consequently, Impala will often run side-by-side with MapReduce on the same physical hardware, with both supporting business-critical workloads. For such multi-tenant clusters, Impala and MapReduce both need to perform well despite potentially conflicting demands for cluster resources.</p>
<p>In this post, we’ll share our experiences configuring Impala and MapReduce for optimal multi-tenant performance. Our goal is to help users understand how to tune their multi-tenant clusters to meet production service level objectives (SLOs), and to contribute to the community some test methods and performance models that can be helpful beyond Cloudera.</p>
<h2>Defining Realistic Test Scenarios</h2>
<p>Cloudera’s broad and diverse customer base makes it a top concern to do testing for real-world scenarios. Realistic tests based on common use cases offer meaningful guidance, whereas guidance based on contrived, unrealistic testing often fails to translate to real-life deployments.</p>
<p>For Impala, our primary test workload directly replicates the queries, schema, and data selectivity of Impala customers. This approach allows us to test query and schema structure common to several classes of use cases. (We often collaborate with customers to obtain similar realistic test scenarios for all CDH components, as well.) Customers benefit by getting direct performance guidance for their specific use cases.</p>
<table style="width: 120px; margin: 6px; padding: 0px 0px 0px 0px;" align="right">
<tbody>
<tr>
<td>
<h3>Guidance based on contrived, unrealistic testing often fails to translate to real-life deployments.</h3>
</td>
</tr>
</tbody>
</table>
<p>Because online analytical processing (OLAP) is one of many possible Impala use cases, we also run <a href="http://www.tpc.org/tpch/">TPC-H</a>, an established benchmark for OLAP, as a secondary workload for Impala. Although TPC-H provides a large, public repository of independently audited results, those results are based on a 1990s survey of OLAP users &#8212; so we run a subset of TPC-H queries that represent prominent use cases today.</p>
<p>For MapReduce, we use a collection of benchmarks designed to use different data formats and stress different stages of the MapReduce compute pipeline. Some examples include the TeraSort Suite (includes TeraGen, TeraSort, and TeraValidate), data shuffling jobs, and jobs that process varying amounts of randomness in the data. These tests are intentionally different from other MapReduce tests that use open source tools like <a href="https://github.com/SWIMProjectUCB/SWIM/wiki">SWIM</a> to directly replay customer workloads of thousands of MapReduce jobs. (Such workloads capture complexity and diversity and will be added in the near future.) In contrast, for our initial multi-tenant tests, we emphasize precisely controlled tests that create easily repeatable, well-defined loads. </p>
<p>The multi-tenant tests include the full combination of our Impala queries, run concurrently with our MapReduce benchmarks. We iterate through the combination &#8212; each time a different Impala query with a different MapReduce job. Multiply this by the range of data sizes, data formats, Impala query concurrency levels, and MapReduce job concurrency levels, and the result is a test matrix of hundreds of settings. This broad test matrix builds confidence that our findings are meaningful and that Impala can share cluster resources with MapReduce as expected.</p>
<h2>Modeling Multi-tenant Performance Expectations</h2>
<p>Multi-tenant resource management involves assigning different resources to workloads from different computation frameworks. It is intractable to model that for the full matrix of hundreds of tests. Instead, for simplicity, we constrict resource assignments to statements like this: “When cluster resources are under contention, Impala gets fraction x of all resources, and MapReduce gets the rest.”</p>
<table style="width: 120px; margin: 6px; padding: 0px 0px 0px 0px;" align="right">
<tbody>
<tr>
<td>
<h3>Our primary test workload directly replicates the queries, schema, and data selectivity of Impala customers.</h3>
</td>
</tr>
</tbody>
</table>
<p>If Impala and MapReduce share resources well, having a fraction of all resources should slow down performance proportionally when the resources in question are under contention. In other words, Impala multi-tenant performance should drop to no less than fraction x of its stand-alone performance, and MapReduce multi-tenant performance should drop to no less than fraction 1-x of its stand-alone performance. Our goal is to find and validate a set of resource management controls such that the observed performance meets or exceeds these expectations.</p>
<p>This is the most conceptually simple model and more elaborate ones are possible. For example, if a MapReduce job runs longer than an Impala query, multi-tenant slowdown would cover only the period that they are both running. The Impala query would see fraction x of stand-alone performance as in the previous model. The MapReduce job would see fraction 1-x of stand-alone performance for the initial part of the job, and stand-alone performance for the rest.</p>
<p>Another extension of the model would be to cover non-uniform resource assignments. For example, most Impala queries have heavy memory demands and most MapReduce jobs have heavy disk IO demands. If we assign Impala 50% of CPU, 60% of memory, and 40% of disk, all the resource changes could simultaneously affect performance and we expect queries in general to slow by some range within 40-60%. This more complex style of resource allocations along multiple dimensions is supported in CDH but not evaluated here.</p>
<h2>Controlling Shared Resources</h2>
<p>The full set of multi-tenant resource management controls are documented in “<a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/CM4Ent/latest/Cloudera-Manager-Installation-Guide/cmig_impala_res_mgmt.html">Setting up a Multi-tenant Cluster for Impala and MapReduce</a>” within the Cloudera Manager installation guide. They include controls to manage memory, CPU, and disk IO for each active compute framework. The documentation there contains numerical examples and step-by-step guides on how to configure each of the following resources.</p>
<ul>
<li><strong>Memory.</strong> The controls include <em>Impala Daemon Memory Limit</em> &#8212; a direct setting for Impala memory consumption, and <em>Maximum Number of Simultaneous Map Tasks and Maximum Number of Simultaneous Reduce Tasks</em>&#8211; indirect memory controls for MapReduce. For memory management, our primary concern is to prevent memory thrashing, job/query failures, or one of the frameworks taking all the resources and preventing workloads in other frameworks from making progress.</P>
<p>To give Impala a fraction x of all memory, we set Impala Daemon Memory Limit to (RAM size / accounting factor) * x. The “accounting factor” is a numerical constant to adjust for OS overhead in translating resident set size to actual RAM use. We’ve found that 1.5 is a relatively safe value, while 1.3 is a more realistic but also more risky value.</p>
<p>For MapReduce, we cut to fraction 1-x the default value for Maximum Number of Simultaneous Map and Reduce Tasks. For example, suppose we give Impala 25% of cluster resources; i.e., x = 25%, we would cut Maximum Number of Simultaneous Map and Reduce Tasks to 75% their default values. If the default values are maximum of 16 simultaneous map tasks and 8 simultaneous reduce tasks, we would set the new values to maximum of 12 simultaneous map tasks and 6 simultaneous reduce tasks. This effectively gives MapReduce the remaining fraction 1-x of the cluster’s memory, as each task carries its own JVM container that holds the data and code needed for the map() and reduce() functions. With this change, any per-job tuning related to slot capacity should be adjusted also. (Note that slot is the smallest unit of adjustment in MR1. For CDH5 and YARN in the future, we would specify instead the quantity of RAM needed. YARN would hand out resources to ApplicationMasters, one of which happens to run MapReduce jobs.)</p>
</li>
<li><strong>CPU.</strong> We control CPU use through <a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/CM4Ent/latest/Cloudera-Manager-Managing-Clusters/cmmc_resource_mgmt.html">Linux Control Groups (Cgroups)</a>. Cgroups is a Linux kernel feature that users can configure via Cloudera Manager 4.5.x and onward. The more <em>Cgroup CPU Shares</em>given to a role, the larger its share of the CPU when under contention. For example, a process with 4 CPU shares will be given roughly twice as much CPU time as a process with 2 CPU shares. We use these controls as &#8220;soft limits&#8221; &#8211;  i.e., the settings will have no effect until processes on the host (including both roles managed by Cloudera Manager and other system processes) are contending for all the CPUs.</p>
<p>In a multi-tenant workload, all Impala and MapReduce processes &#8211; Impala daemons, DataNodes, and TaskTrackers &#8211; may be simultaneously consuming CPU. To assign fraction x of CPU to Impala and the rest to MapReduce, we set fraction x of CPU shares to the Impala daemon, and half of the remainder each to the DataNode and the TaskTracker.</p>
<p>This is a conservative setting for MapReduce. It assumes that DataNode and task computational activity can simultaneously maximize CPU activity. If your MapReduce workload is far below cluster capacity, this is unlikely to be true. For example, when you have one MapReduce job, usually DataNode (job input/output) and TaskTracker (tasks) CPU activities will not overlap. It&#8217;s only when you have a very large workload that in aggregate, DataNode and TaskTracker activity will be simultaneous.</p>
</li>
<li><strong>Disk. </strong>Disk IO is also controlled by Cgroups. The more the <em>Cgroup I/O Weight</em>given to a role, the higher priority will be given to I/O requests made by the role when I/O is under contention. The effect is nearly identical to that of the CPU controls.</p>
<p>We also choose a conservative setting to assign disk resources: The Impala daemon gets fraction x of IO weights; half of the remainder goes to the DataNode, and the other half goes to the TaskTracker.</p>
</li>
</ul>
<table style="width: 120px; margin: 6px; padding: 0px 0px 0px 0px;" align="right">
<tbody>
<tr>
<td>
<h3>For future tests, we will explore how to control Impala and MapReduce workload intensity to create sustained conflicts in resource demands.</h3>
</td>
</tr>
</tbody>
</table>
<h2>Multi-tenant Performance Results</h2>
<p>Our tests have these goals:</p>
<ul>
<li>Measure uncontrolled multi-tenant behavior</li>
<li>Measure multi-tenant behavior using controls described so far</li>
<li>Understand resource contention in both set of tests above</li>
<li>Understand stand-alone behavior subject to resource management controls</li>
</ul>
<p>Our test cluster machines have 64GB memory, 12 cores of 2.0GHz Intel Xeon, 12x 2TB disks, and 10Gbps Ethernet. The baseline behavior is MapReduce running by itself, and Impala running by itself, on the cluster without any resource management controls. We express multi-tenant performance as a fraction of this uncontrolled, stand-alone performance. This is a good baseline because the uncontrolled, stand-alone setup is equivalent to dedicated MapReduce or Impala clusters.</p>
<h3>Uncontrolled Multi-tenant Behavior</h3>
<p>We measured multi-tenant performance without the resource management controls described previously. For our tests, MapReduce consumed the majority of cluster resources, which heavily affected Impala performance. Specifically, uncontrolled multi-tenant MapReduce dropped to a median of ~90% its uncontrolled stand-alone performance and uncontrolled multi-tenant Impala dropped to a median of ~50% of uncontrolled stand-alone performance.</p>
<p>These numbers reflect a higher than expected uncontrolled multi-tenant performance. The suspected reason is that Impala and MapReduce resource demands are not always in conflict. For our future tests, we will explore how to control Impala and MapReduce workload intensity to create sustained conflicts in resource demands.</p>
<p>Our resource management mechanisms improve on this uncontrolled behavior in several ways. First, the cluster resources are less likely to become overcommitted. Specifically, the controlled behavior setup is more “memory safe” such that memory-heavy workloads have a lower risk of causing swapping/thrashing. Second, the user gains the ability to dial-up or dial-down the resources consumed by each framework. For example, if the uncontrolled setup results in Impala performance that is below production SLOs, the user can turn on resource controls and shift resources from MapReduce to Impala so that both can meet desired SLOs.</p>
<h3>Multi-tenant Behavior under Resource Management</h3>
<p>The resource management controls allow us to assign fraction x of all cluster resources to, say, Impala, and the rest to MapReduce. We measured performance for 25-75, 40-60, 50-50, 60-40, and 75-25 resource splits between Impala and MapReduce. The test results demonstrate that we can indeed control multi-tenant performance by assigning more resources to a compute framework.</p>
<p>The graphs below show Impala and MapReduce multi-tenant performance. Each data point on the graph shows the median slowdown for that setting while the error bars show the 25-75 percentile slowdown across the test matrix. They also show the expected performance according to the previous models.</p>
<p align="center"><img title="yanpei1" src="http://blog.cloudera.com/wp-content/uploads/2013/06/yanpei1.png" alt="" width="532" height="357" /></p>
<p align="center"><img title="yanpei2" src="http://blog.cloudera.com/wp-content/uploads/2013/06/yanpei2.png" alt="" width="532" height="357" /></p>
<p>The graphs indicate that Impala and MapReduce multi-tenant performance both meet or exceed predicted performance according to the previous models. There are some Impala query and MapReduce job combinations where performance is barely affected in a multi-tenant environment (error bars close to fraction 1 of stand-alone performance). There are also some combinations where performance is affected beyond that predicted by earlier models (error bars below the “Modeled” line). Most combinations meet or exceed our expectations. As before, the suspected reason is that Impala and MapReduce resource demands are not always in conflict.</p>
<h3>Verifying Resource Contention</h3>
<p>We used Cloudera Manager to monitor physical resource utilization during both the uncontrolled and controlled multi-tenant tests. Memory is almost fully used all the time. CPU and disk loads are bursty and contention occurs only some of the time. This behavior likely explains our test results where Impala and MapReduce both exceed the performance model.</p>
<h3>Stand-alone Behavior with Resource Management</h3>
<p>Multi-tenant resource management should behave as soft limits. In other words, when there is only one framework active, it should behave as if it has the entire cluster to itself. The CPU and disk controls above are soft limits by design while the memory controls are hard limits. Hence, we felt it necessary to measure stand-alone performance subject to resource management controls. Note this is different from the previous baseline of stand-alone performance without resource management controls.</p>
<p>Impala behaves exactly as if it had the entire cluster to itself. This is the intended behavior for the Impala daemon memory limit. Either the query behaves unaffected, or, upon hitting the memory limit, the query would be aborted.</p>
<p>For MapReduce, the behavior is more complex. Cutting the available slots places an upper bound on the amount of parallelism. For modest cuts, there would still be enough parallelism to drive resources to full utilization, and the performance impact would be small. For severe cuts, the remaining slots would not be enough to drive resources to full utilization, and the performance impact would be large.</p>
<p>What are “moderate” and “severe” cuts depend on the cluster hardware. For our test cluster, cutting the slots to 50% results in only 15% performance drop. However, cutting the slots to 25% gives stand-alone performance that is roughly the same as multi-tenant performance, meaning that the available slots, and not resource contention, becomes the performance constraint for MapReduce. Hence, depending on cluster hardware, there may be room to relax the settings for resource management controls as we described earlier.</p>
<h2>What’s Next?</h2>
<p>Big data multi-tenant performance represents a cutting edge engineering problem with immediate impact for many users. Our test methods, models, and results carry a high level of real-world relevance, mathematical rigor, and empirical repeatability.</p>
<p>One immediate follow up effort is to expand our test scenarios to cover multi-query Impala workloads running concurrently with multi-job MapReduce workloads, each with a controlled level of workload intensity.</p>
<p>Overall, we hope this post can help users tune their multi-tenant clusters to meet production SLOs, and help the community at large understand how to manage resources in a shared big data platform.</p>
<p><em>Yanpei, Prashant, and Arun are members of the Performance Team at Cloudera. </em></p>

				<div class="social-buttons">
<span class='st_facebook_large' displayText='Facebook'></span>
<span class='st_twitter_large' displayText='Tweet'></span>
<span class='st_linkedin_large' displayText='LinkedIn'></span>
<span class='st_googleplus_large' displayText='Google +'></span>
<span class='st_email_large' displayText='Email'></span>
				</div>
			</div>

			<div class="grid_2" style="margin:0">
  <div class="comments comments-2">
    <div class="field-under">
      <h4>Filed under:</h4>
      <ul class="post-categories">
	<li><a href="http://blog.cloudera.com/blog/category/cdh/" title="View all posts in CDH" rel="category tag">CDH</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/hardware/" title="View all posts in Hardware" rel="category tag">Hardware</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/impala/" title="View all posts in Impala" rel="category tag">Impala</a></li></ul>  	</div>
  	
  <a name="comments"></a>
  <div class="comments-head">
    <strong>No Responses</strong>
   
  </div>
  <ul class="comments-list">
    </ul>
  <a name="leave-comment"></a>
  <form action="/wp-comments-post.php" method="POST">
  	<div class="comment-form">
  		<h4>Leave a comment</h4>
  		<div class="row">
  			<input type="text" value="" class="txt" name="author"/>
  			<label>Name <span>required</span></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="email"/>
  			<label class="published">Email <span>required</span> <em>(will not be published)</em></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="url"/>
  			<label>Website</label>
  		</div>
  		<div class="row">
  			<textarea rows="10" cols="30" class="area" name="comment"></textarea>
  			<label>Comment</label>
  		</div>
  		<fieldset>
  			<input type="button" value="Leave Comment" class="btn cta"/>
  		</fieldset>
  	</div>
  	<input type='hidden' name='comment_post_ID' value='22105' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
  	<p class="cptch_block"><label>Prove you're human!<span class="required"> *</span></label><br />		<input type="hidden" name="cptch_result" value="iBU=" />
		<input type="hidden" name="cptch_time" value="1397909854" />
		<input type="hidden" value="Version: 2.4" />
		1 &times; <input id="cptch_input" type="text" autocomplete="off" name="cptch_number" value="" maxlength="2" size="2" aria-required="true" required="required" style="margin-bottom:0;display:inline;font-size: 12px;width: 40px;" /> =  f&#105;&#118;e	</p>  </form>
</div></section>




<!-- Google Code for New Remarketing Pixel -->
<!-- Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. For instructions on adding this tag and more information on the above requirements, read the setup guide: google.com/ads/remarketingsetup -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 1035979479;
var google_conversion_label = "xel9CJ-P0QMQ15X_7QM";
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>

<noscript>
<div style="display:inline;"> <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1035979479/?value=0&label=xel9CJ-P0QMQ15X_7QM&guid=ON&script=0"/> </div>
</noscript>
</section>
<span class="bg-fix"></span>
</div>
</div>
<footer id="global-footer">
<div class="footerContent parbase">
<footer>
  <div class="wrapper">
    <div class="bg-fix"></div>
    <nav>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/products-and-services.html">Products</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products/cloudera-enterprise.html">Cloudera Enterprise</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-express.html">Cloudera Express</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-enterprise/cloudera-manager.html">Cloudera Manager</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cdh.html">CDH</a></li>
        <li><a href="http://www.cloudera.com/content/support/en/downloads.html">All Downloads</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/professional-services.html">Professional Services</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/training.html">Training</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/solutions.html">Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/enterprise-solutions.html">Enterprise Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/partner.html">Partner Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/industries.html">Industry Solutions</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/partners.html">Partners</a></li>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/resources/library.html">Resource Library</a></li>
        <li class="section"><a href="https://ccp.cloudera.com/display/SUPPORT/Get+Support">Support</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/about.html">About</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/hadoop-and-big-data.html">Hadoop &amp; Big Data</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/management.html">Management Team</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/board.html">Board</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/events.html">Events</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/press-center.html">Press Center</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/careers.html">Careers</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/contact-form.html">Contact Us</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/subscription-center.html">Subscription Center</a></li>
      </ul>
      <div class="locale-and-social" style="float:right">
        <div>
          <div class="locale-and-social">
            <div class="locale">
              <select onchange="this.options[this.selectedIndex].value &amp;&amp; (window.location = this.options[this.selectedIndex].value);" class="site-language">
                <option value="http://www.cloudera.com" name="English">English</option>
                <option value="http://www.cloudera.co.jp/">Japanese</option>
              </select>
            </div>
            <div class="social"><span class="follow">Follow us:</span><span class="share">Share:<i class="icon-share"></i></span>
              <ul>
                <li><a class="linkedIn" target="_blank" href="http://www.linkedin.com/company/cloudera">LinkedIn</a></li>
                <li><a class="twitter" target="_blank" href="http://twitter.com/cloudera">Twitter</a></li>
                <li><a class="facebook" target="_blank" href="http://www.facebook.com/cloudera">Facebook</a></li>
                <li><a class="youtube" target="_blank" href="http://www.youtube.com/user/clouderahadoop">YouTube</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <nav class="global-footer"><span class="logo"><a>Cloudera</a></span>
      <address>
      <span>Cloudera, Inc.</span> <span><a target="_blank" href="http://www.google.com/maps?q=1001+Page+Mill+Rd,+Palo+Alto,+CA+94306">1001 Page Mill Road Bldg 2</a></span> <span>Palo Alto, CA 94304</span>
      </address>
      <address>
      <span><a href="http://www.cloudera.com">www.cloudera.com</a></span> <span>US: 1-888-789-1488</span> <span>Intl: 1-650-362-0488</span>
      </address>
      <div class="copyright"><span><span class="piped">©2014 Cloudera, Inc. All rights reserved</span><span class="piped"><a href="http://www.cloudera.com/content/cloudera/en/terms-of-service.html">Terms &amp; Conditions</a></span><a href="http://www.cloudera.com/content/cloudera/en/privacy-policy.html">Privacy Policy</a></span> <span>Hadoop and the Hadoop elephant logo are trademarks of the <a target="_blank" href="http://www.apache.org/">Apache Software Foundation</a>.</span></div>
    </nav>
  </div>
</footer>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.3.2'></script>
<div class="modal" style="display:none">
  <div id="password-required">
    <div class="inner"> </div>
  </div>
</div>
<div class="tooltip" class="tooltip" style="display:none">
</div>
<script type="text/javascript" src="http://dnn506yrbagrg.cloudfront.net/pages/scripts/0011/2160.js"></script>
<script type="text/javascript">var _kiq = _kiq || [];</script> 
<script type="text/javascript" src="http://s3.amazonaws.com/ki.js/14646/2Sr.js" async></script>
</body></html>
