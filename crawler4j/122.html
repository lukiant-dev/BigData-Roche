<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
<title>Email Indexing Using Cloudera Search | Cloudera Developer Blog</title>

<meta name="keywords" content="hadoop, hadoop training, cloudera, hadoop tutorial, hadoop certification, apache hadoop, hadoop download, big data, open source" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="msvalidate.01" content="8857B9071A02F989DE3F8BEE557BB584" />

<link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Cloudera" />

<meta property="og:title" content="Email Indexing Using Cloudera Search"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://blog.cloudera.com/blog/2013/09/email-indexing-using-cloudera-search/"/>
<meta property="og:site_name" content="Cloudera Developer Blog"/>


<link rel="icon" href="/wp-content/themes/solutionset/assets/favicon.ico" type="image/x-icon" /> 
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/960.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/reset.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/all.css?20120620" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/wp.css?20120620" /> 

<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 8]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6-7.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 9]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie.css?20120605" media="screen"/><![endif]-->

<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/modernizr-2.6.1.min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4.4-more-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript"> jQuery.noConflict(); </script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery.colorbox-min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/global.js?20120605"></script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "ur-aa86c136-1042-b30d-950-dd905bb179a0", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>


<link rel="pingback" href="http://blog.cloudera.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Feed" href="http://blog.cloudera.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Comments Feed" href="http://blog.cloudera.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Email Indexing Using Cloudera Search Comments Feed" href="http://blog.cloudera.com/blog/2013/09/email-indexing-using-cloudera-search/feed/" />
<link rel='stylesheet' id='prettify-gc-syntax-highlighter-css'  href='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='cptchStylesheet-css'  href='http://blog.cloudera.com/wp-content/plugins/captcha/css/style_wp_before_3.8.css?ver=3.3.2' type='text/css' media='all' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.cloudera.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.cloudera.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='What’s Next for Impala After Release 1.1' href='http://blog.cloudera.com/blog/2013/09/whats-next-for-impala-after-release-1-1/' />
<link rel='next' title='How-to: Use HBase Bulk Loading, and Why' href='http://blog.cloudera.com/blog/2013/09/how-to-use-hbase-bulk-loading-and-why/' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='http://blog.cloudera.com/blog/2013/09/email-indexing-using-cloudera-search/' />
<link rel='shortlink' href='http://blog.cloudera.com/?p=23233' />


<script type="text/javascript">
 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-2275969-16']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();
</script>


</head>
<body class="single single-post postid-23233 single-format-standard devcenter">
			
		
			
	<header id="site-head">
<nav class="properties">
            <div class="container">
                <ul>
                    <!--<li><a href="http://www.cloudera.com">Cloudera.com</a></li>-->
                     <!--<li><a href="http://university.cloudera.com">Cloudera University</a></li>
                   <li><a href="${config.LINK_CCP}/display/DOC/Documentation">Documentation</a></li>-->
                    <li><a id="support_home_page" href="http://cloudera.com/content/support/en/home.html" class="active">Support</a></li>
                    <li><a href="http://cloudera.com/content/dev-center/en/home.html">Developers</a></li>
                  <!--<li><a href="http://cloudera.com/content/cloudera/en/partners.html">PARTNERS</a></li>-->
                   
                </ul>
                <ul class="user">
                    <li>
                       <!--<a id="signinLink" class="hidden" href="https://clouderapkb.echolane.cs3.force.com/idp/login?app=0spQ00000004CD5">Sign In</a>-->
<a id="signinLink" class="hidden" href="https://cloudera.secure.force.com">Sign In</a>
                    </li>
                    <li><a id="registerLink" class="hidden" href="http://cloudera.com/content/support/en/user-registration.html">Register</a></li>
                    <li><a href="http://cloudera.com/content/cloudera/en/about/contact-us.html">Contact Us</a></li>
                    <li><a href="http://cloudera.com/content/support/en/downloads.html">Downloads</a></li>
                    <li>
                        <div id="dropdownAction" class="dropdown" style="display:none">
                            <a id="lnkDropdowntoogle" data-toggle="dropdown" class="dropdown-toggle" href="#">

                            </a>
                            <ul aria-labelledby="dropdownMenu" tole="menu" class="dropdown-menu">
                                <li><a href="http://cloudera.com/content/support/en/edit-user-profile.html" id="editProfileLink" tabindex="-1">Edit Profile</a></li>
                                <li class="divider"></li>
                                <li>
                                <a id="logoutLink" tabindex="-1" href="#">Logout</a>
                                </script>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="bg-fix"></div>
        </nav>
<!--</div>-->

<div class="wrapper">
    <div class="bg-fix"></div>
    <h1 class="logo">
        <a href="http://cloudera.com/content/cloudera/en/home.html">Cloudera</a>
    </h1>

<nav class="site">
        <ul>
    <li class="">
 <a href="http://community.cloudera.com" data-link="external">Community</a>
</li>
<li class="">
 <a href="http://cloudera.com/content/support/en/documentation.html" data-link="external">Documentation</a>
</li>
 <li class="">
                    <a href="http://cloudera.com/content/support/en/downloads.html" data-link="external">Downloads</a>
   </li>
     <li class="">
                    <a href="http://university.cloudera.com" data-link="external">Training</a>
     </li>
<li class="">
                    <a href="http://blog.cloudera.com" data-link="external" class="active">Blogs</a>
                    <nav class="subnav menu"> <nav><ul>
<li><a href="http://vision.cloudera.com">Cloudera Vision</a></li>
<!--<li><a href="http://blog.cloudera.com/blog">Developer Blog</a></li>-->
</ul>
</nav> </nav>
</li>
            
        </ul>
    </nav>


    <div class="form-holder">
		
	    <form action="http://cloudera.com/content/cloudera/en/search.html" id="site-search" method="get" novalidate> 
	        <label for="q" class="visuallyhidden">Search</label> 
	        <input type="search" name="q" id="q" placeholder="Search"><i class="icon-search"></i> 
	    </form>
    </div>
    </div><!--</div>-->
        </header>
				
	<div role="main" class="main">
		<div class="wrapper">
			<section class="two-col">

	
<aside class="left-col">

				<nav>
			<ul class=" ">
			
								
							<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/hadoop-and-big-data.html"
					title="Hadoop &amp; Big Data"
					class=""
					target="_blank"				>
					Hadoop &amp; Big Data				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/our-customers.html"
					title="Our Customers"
					class=""
					target="_blank"				>
					Our Customers				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/faqs.html"
					title="FAQs"
					class=""
					target="_blank"				>
					FAQs				</a>

							</li>
			
					<li class="current">
				<a
					href="/blog/"
					title="Blog"
					class="blog"
									>
					Blog				</a>

									<ul>
									<li class="">
				<a
					href="/blog/category/accumulo/"
					title="Accumulo (1)"
					class=""
									>
					Accumulo (1)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/avro/"
					title="Avro (16)"
					class=""
									>
					Avro (16)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/bigtop/"
					title="Bigtop (6)"
					class=""
									>
					Bigtop (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/books/"
					title="Books (6)"
					class=""
									>
					Books (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/careers/"
					title="Careers (14)"
					class=""
									>
					Careers (14)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cdh/"
					title="CDH (127)"
					class=""
									>
					CDH (127)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloud-2/"
					title="Cloud (9)"
					class=""
									>
					Cloud (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-life/"
					title="Cloudera Life (3)"
					class=""
									>
					Cloudera Life (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-manager/"
					title="Cloudera Manager (61)"
					class=""
									>
					Cloudera Manager (61)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/community/"
					title="Community (182)"
					class=""
									>
					Community (182)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-collection/"
					title="Data Collection (17)"
					class=""
									>
					Data Collection (17)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-science/"
					title="Data Science (26)"
					class=""
									>
					Data Science (26)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/distribution/"
					title="Distribution (36)"
					class=""
									>
					Distribution (36)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/events/"
					title="Events (37)"
					class=""
									>
					Events (37)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/flume/"
					title="Flume (18)"
					class=""
									>
					Flume (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/general/"
					title="General (327)"
					class=""
									>
					General (327)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/guest/"
					title="Guest (77)"
					class=""
									>
					Guest (77)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hadoop/"
					title="Hadoop (294)"
					class=""
									>
					Hadoop (294)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hardware/"
					title="Hardware (3)"
					class=""
									>
					Hardware (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hbase/"
					title="HBase (124)"
					class=""
									>
					HBase (124)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hdfs/"
					title="HDFS (45)"
					class=""
									>
					HDFS (45)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hive/"
					title="Hive (62)"
					class=""
									>
					Hive (62)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/how-to/"
					title="How-to (53)"
					class=""
									>
					How-to (53)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hue/"
					title="Hue (30)"
					class=""
									>
					Hue (30)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/impala/"
					title="Impala (63)"
					class=""
									>
					Impala (63)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/kite-sdk/"
					title="Kite SDK (11)"
					class=""
									>
					Kite SDK (11)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mahout-2/"
					title="Mahout (5)"
					class=""
									>
					Mahout (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mapreduce/"
					title="MapReduce (71)"
					class=""
									>
					MapReduce (71)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/meet-the-engineer/"
					title="Meet The Engineer (18)"
					class=""
									>
					Meet The Engineer (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/oozie/"
					title="Oozie (25)"
					class=""
									>
					Oozie (25)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/ops/"
					title="Ops And DevOps (19)"
					class=""
									>
					Ops And DevOps (19)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/pig/"
					title="Pig (35)"
					class=""
									>
					Pig (35)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/quickstart-vm/"
					title="QuickStart VM (5)"
					class=""
									>
					QuickStart VM (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/search/"
					title="Search (21)"
					class=""
									>
					Search (21)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/security-2/"
					title="Security (15)"
					class=""
									>
					Security (15)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/spark/"
					title="Spark (9)"
					class=""
									>
					Spark (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/sqoop/"
					title="Sqoop (20)"
					class=""
									>
					Sqoop (20)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/support/"
					title="Support (4)"
					class=""
									>
					Support (4)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/testing/"
					title="Testing (8)"
					class=""
									>
					Testing (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/this-month-in-the-ecosystem/"
					title="This Month In The Ecosystem (8)"
					class=""
									>
					This Month In The Ecosystem (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/tools/"
					title="Tools (6)"
					class=""
									>
					Tools (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/training-2/"
					title="Training (42)"
					class=""
									>
					Training (42)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/use-case/"
					title="Use Case (59)"
					class=""
									>
					Use Case (59)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/whirr/"
					title="Whirr (6)"
					class=""
									>
					Whirr (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/yarn/"
					title="YARN (13)"
					class=""
									>
					YARN (13)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/zookeeper/"
					title="ZooKeeper (24)"
					class=""
									>
					ZooKeeper (24)				</a>

							</li>
			
					<li class="">
				<a
					href="/archive/"
					title="Archives by Month"
					class=""
									>
					Archives by Month				</a>

							</li>
			
							</ul>
							</li>
			
						
			    
			
				<div style="clear:both"></div>
			</ul>
			</nav>
			<div class="menu-special">
				<ul>
							
				
				
		
				
		
				
				
				
				

		
					</ul>
			</div>
			
</aside>


<section>
			<h1 class="heading ">Email Indexing Using Cloudera Search</h1>
			
			<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
			
			<ul class="post-info">
				<li>by Jeff Shmain</li>
				<li>September 25, 2013</li>
				<li class="comment"><a href="#comments">3 comments</a></li>
				
			</ul>
			
			<div class="text-block">
				<p>Why would any company be interested in searching through its vast trove of email? A better question is: Why wouldn’t everybody be interested? </p>
<p>Email has become the most widespread method of communication we have, so there is much value to be extracted by making all emails searchable and readily available for further analysis. Some common use cases that involve email analysis are fraud detection, customer sentiment and churn, lawsuit prevention, and that’s just the tip of the iceberg. Each and every company can extract tremendous value based on its own business needs. </p>
<p>A little over a year ago we <a href="http://blog.cloudera.com/blog/2012/01/hadoop-for-archiving-email-part-2/">described</a> how to archive and index emails using HDFS and Apache Solr. However, at that time, searching and analyzing emails were still relatively cumbersome and technically challenging tasks. We have come a long way in document indexing automation since then &#8212; especially with the recent introduction of <a href="http://www.cloudera.com/content/cloudera/en/products/cdh/search.html">Cloudera Search</a>, it is now easier than ever to extract value from the corpus of available information.</p>
<p>In this post, you’ll learn how to set up Apache Flume for near-real-time indexing and MapReduce for batch indexing of email documents. Note that although this post focuses on email data, there is no reason why the same concepts could not be applied to instant messages, voice transcripts, or any other data (both structured and unstructured). </p>
<h2>Where to Start</h2>
<p>Every document that you would like to make searchable must live in an index. In addition, the documents themselves must be broken up to provide the capability of searching on specific fields.</p>
<p>The diagram below provides a high-level view of how indexes, documents, and fields are related:</p>
<p align="center"><img title="shmain1" src="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain11.png" alt="" width="409" height="226" /></p>
<p>The first thing to do is to break down the emails into fields that are of particular interest to the use case.  The fields will be used for building the indexes and facets. To understand the fields of the email, we will use the Mime 1.0 standard, which is defined <a href="http://www.ietf.org/rfc/rfc1521.txt">here</a>. Below is the text from a sample email, with relevant fields highlighted (This email came from a public archive.)</p>
<p align="center"><img title="shmain2" src="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain2.png" alt="" width="516" height="637" /></p>
<p>Cloudera Search is based on Solr, which includes multiple other components such as Apache Lucene, SolrCloud, Apache Tika, and Solr Cell. Let’s begin by editing Solr’s schema.xml file to incorporate the fields we have identified in the previous exercise. Throughout this document, you will extensively use the solrctl command to manage SolrCloud deployments. (See the full command reference <a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/Search/latest/Cloudera-Search-User-Guide/csug_solrctl_ref.html">here</a>.)</p>
<p>The command below will generate a template schema.xml file that you will update to fit our email use case.  </p>
<pre class="code" style="padding-left: 10px;">$ solrctl --zk localhost:2181/solr instancedir --generate $HOME/emailSearchConfig
</pre>
<p>&nbsp;</p>
<p>(Please note that &#8211;zk localhost:2181 should be replaced with the address and port of your own Apache ZooKeeper quorum.)<br />  <br /> Next, edit the schema.xml file (which can be found <a href="https://github.com/jshmain/cloudera-search/blob/master/email-search/schema.xml">here</a>). What follows is a brief overview of what was changed from the template generated above. </p>
<p>First, completely replace the &lt;fields&gt; and &lt;fieldTypes&gt; section with the one below and add the additional &#8220;to&#8221; line. The email addresses need to be tokenized differently from the rest of the text &#8212; therefore, we created email_general field type below, using the solr.UAX29URLEmailTokenizerFactory tokenizer. Similarly, use a new field type, names_general, for fields that contain names. Date fields use the tdate field type, which allows for easy date range faceting. All other fields are just set up as text_general, which is supplied in the default Solr schema.xml file. <br />  </p>
<pre class="code" style="padding-left: 10px;">&lt;fields&gt;
    &lt;field name="message_id" type="string" indexed="true" stored="true" required="true" multiValued="false" /&gt;
    &lt;field name="date" type="tdate" indexed="true" stored="true"/&gt;
    &lt;field name="from" type="email_general" indexed="true" stored="true"/&gt;
    &lt;field name="to" type="email_general" indexed="true" stored="true"/&gt;
    &lt;field name="subject" type="text_general" indexed="true" stored="true"/&gt;
    &lt;field name="from_names" type="names_general" indexed="true" stored="true"/&gt;
    &lt;field name="to_names" type="names_general" indexed="true" stored="true"/&gt;
    &lt;field name="cc" type="email_general" indexed="true" stored="true"/&gt;
    &lt;field name="bcc" type="text_general" indexed="true" stored="true"/&gt;
    &lt;field name="cc_names" type="names_general" indexed="true" stored="true"/&gt;
    &lt;field name="bcc_names" type="names_general" indexed="true" stored="true" /&gt;
    &lt;field name="x_folder" type="text_general" indexed="true" stored="false" /&gt;
    &lt;field name="x_origin" type="text_general" indexed="true" stored="false" /&gt;
    &lt;field name="x_filename" type="text_general" indexed="true" stored="false"/&gt;
    &lt;field name="message" type="text_general" indexed="false" stored="false"/&gt;
    &lt;field name="body" type="text_general" indexed="true" stored="true"/&gt;
    &lt;field name="text" type="text_general" indexed="false" stored="false" /&gt;
    &lt;field name="_version_" type="long" indexed="true" stored="true"/&gt;
  &lt;/fields&gt;
  &lt;uniqueKey&gt;message_id&lt;/uniqueKey&gt;

&lt;fieldType name="names_general" class="solr.TextField" &gt;
    &lt;analyzer type="index"&gt;
      &lt;charFilter class="solr.HTMLStripCharFilterFactory" /&gt;
      &lt;tokenizer class="solr.StandardTokenizerFactory"/&gt;
      &lt;filter class="solr.LowerCaseFilterFactory"/&gt;
    &lt;/analyzer&gt;
    &lt;analyzer type="query"&gt;
      &lt;charFilter class="solr.HTMLStripCharFilterFactory" /&gt;
      &lt;tokenizer class="solr.StandardTokenizerFactory"/&gt;
      &lt;filter class="solr.LowerCaseFilterFactory"/&gt;
    &lt;/analyzer&gt;
  &lt;/fieldType&gt;
  &lt;fieldType name="email_general" class="solr.TextField" &gt;
    &lt;analyzer type="index"&gt;
      &lt;tokenizer class="solr.UAX29URLEmailTokenizerFactory" /&gt;
      &lt;filter class="solr.LowerCaseFilterFactory"/&gt;
    &lt;/analyzer&gt;
    &lt;analyzer type="query"&gt;
      &lt;tokenizer class="solr.UAX29URLEmailTokenizerFactory" /&gt;
      &lt;filter class="solr.LowerCaseFilterFactory"/&gt;
    &lt;/analyzer&gt;
  &lt;/fieldType&gt;
</pre>
<p>&nbsp;</p>
<p>One very important concept in SolrCloud deployments is the notion of collections. A “collection” is a single index that spans multiple Solr Instances. For example, if your email index is distributed across two Solr Instances, they all add up to form one collection. Let’s call our collection email_collection and set it up using the commands below:</p>
<pre class="code" style="padding-left: 10px;">$ solrctl --zk localhost:2181/solr instancedir --create email_collection $HOME/emailSearchConfig
$ solrctl --zk localhost:2181/solr collection --create email_collection -s 2
</pre>
<p>Again, replace &#8211;zk localhost:2181 with your own ZooKeeper quorum configuration in both statements.<br />  <br />Note that the &#8220;-s 2&#8243; argument defines the number of shards. A “shard” is a very important concept in Solr and refers to a slice of an index. For example, if you have a corpus of 1 million emails, you may want to split it into two shards for scalability and to improve query performance. The first shard will handle all the documents that have a message-id between 0 &#8211; 500,000, and the second shard will handle documents with message id between 500,000 &#8211; 1,000,000. This logic is all handled by Solr internally; you need only specify the number of shards you would like to create with the -s option.</p>
<p>The number of shards will depend on many factors and should be determined carefully. The following table describes some of the considerations that should go into choosing the optimal number:</p>
<p align="center"><img title="table1" src="http://blog.cloudera.com/wp-content/uploads/2013/09/table1.png" alt="" width="484" height="159" /></p>
<h2>How Email Parsing Happens</h2>
<p>Email parsing is achieved with the help of <a href="https://github.com/cloudera/cdk/tree/master/cdk-morphlines">Cloudera Morphlines</a><a href="https://github.com/cloudera/cdk/tree/master/cdk-morphlines">.</a>  The Morphlines library is an open source framework, available through the <a href="http://www.cloudera.com/content/dev-center/en/home/developer-admin-resources/cloudera-development-kit.html">Cloudera Development Kit</a> (CDK), that defines a transformation chain without a single line of code needed.</p>
<p>The Morphlines configuration file defines the transformation chain. We will define a Morphlines configuration file and use it later for both batch and near real-time indexing.</p>
<p>The Email morphlines library will perform the following actions:</p>
<ol>
<li>Read the email events with the <code>readMultiLine</code> command</li>
<li>Break up the unstructured text into fields with the <code>grok</code> command</li>
<li>If Message-ID is missing from the email, generate it with the <code>generateUUID</code> command</li>
<li>Convert the date/timestamp into a field that Solr will understand, with the <code>convertTimestamp</code> command</li>
<li>Drop all of the extra fields that we did not specify in schema.xml, with the <code>sanitizeUknownSolrFields</code> command</li>
<li>Load the record into Solr for HDFS write, with the <code>loadSolr</code> command</li>
</ol>
<p>To view the full Morphline configuration file for this example, please visit this <a href="https://github.com/jshmain/cloudera-search/blob/master/email-search/morphlines.conf">link</a>.</p>
<h2>Which Tool to Use for Indexing</h2>
<p>Cloudera Search can index emails in various ways. In a near-real-time scenario, Cloudera Search will utilize Flume to index messages on their way into HDFS.  As the data passes through Flume, relevant fields will be extracted using MorphlineSolrSink. Solr will then index the event and write the indexes to HDFS. For the batch-oriented scenarios, Cloudera Search provides MapReduceIndexerTool, which will read the data out of HDFS, build the indexes, and write them out back to HDFS. There are multiple options in the tool, including one that will merge the generated indexes into live Solr Servers.</p>
<p>The appropriate indexing method will be dictated entirely by your use case and data ingestion strategy. For example, if you are doing customer churn analysis, you may initiate a periodic search query for words that signify a negative sentiment. As emails from customers come into the system, you may need to persist and index them right away. In that case, the indexing must be done in near-real-time and the data would be ingested through a Flume Agent. But suppose you already have five years of emails already stored on HDFS?  If you need to index them, the only scalable option is to run MapReduceIndexerTool.</p>
<p>In some use cases, both methods may be needed. For example, if most of the emails are indexed in real time but later on you identify a new field that was not indexed before, you may need to go back and run MapReduceIndexerTool to reindex the whole corpus. (There is an HBase near-real time indexer as well, but we’ll address that in a future post.)</p>
<p>The table below describes some question that may help you identify optimal indexing tools: </p>
<p align="center"><img title="table2" src="http://blog.cloudera.com/wp-content/uploads/2013/09/table2.png" alt="" width="532" height="240" /></p>
<h2>How to Run Batch Indexing</h2>
<p>The flow of the MapReduceIndexerTool is straightforward:</p>
<p align="center"><img title="shmain3" src="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain3.png" alt="" width="513" height="361" /><br />  </p>
<ol>
<li>Read the HDFS directory with the files that need to be indexed.</li>
<li>Pass them through the morphline, which will perform the following transformation chain:</li>
<ol>
<li>Break the text up into fields with <code>grok</code> command</li>
<li>Change the date field into Date Time that Solr will understand</li>
<li>Drop all of the extra fields that you did not specify in the schema.xml file</li>
<li>Generate the indexes and store them to HDFS</li>
<li> Merge the indexes into live SOLR servers</li>
</ol>
</ol>
<p>To run the MapReduceIndexerTool, execute the following command:</p>
<pre class="code" style="padding-left: 10px;" dir="">/contrib/mr/search-mr-0.9.2-cdh4.3.0-SNAPSHOT-job.jar \

org.apache.solr.hadoop.MapReduceIndexerTool \

--morphline-file &lt;morphlines file&gt; \

--output-dir &lt;hdfs URI for indexes&gt; --go-live --zk-host clust2:2181/solr \ --collection email_collection &lt;HDFS URI with the files to index&gt;
</pre>
<p>A few notes:</p>
<ul>
<li>&lt;cloudera search directory&gt; is the directory where search tools are installed. If you installed via packages, this would be /usr/lib/solr. If you installed via parcels, it would be the directory where the Search parcel was deployed. </li>
<li>&lt;morphlines file&gt; is the location of the morphlines config file that was created above.</li>
<li>The &#8211;go-live option will actually merge the indexes into Solr Server.</li>
</ul>
<p>For a full description of the above command, read this <a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/Search/latest/Cloudera-Search-User-Guide/csug_mapreduceindexertool.html?scroll=csug_topic_6_1">doc</a>.</p>
<h2>How to Index in Near-Real Time Using Flume</h2>
<p>The flow for near-real-time indexing looks more complex than batch indexing, but it is just as simple:</p>
<p align="center"><img title="shmain4" src="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain4.png" alt="" width="500" height="434" /></p>
<ol>
<li>As the email files are dropped into the spooling directory, Flume will pick them up.</li>
<li>Flume will replicate them into two different memory channels.</li>
<li>The first channel is read by HDFS Sink and rolled directly into HDFS.</li>
<li>The second channel is read by MorphlineSolrSink, which will perform the same transformation chain as described previously:</li>
<ol>
<li>Break the text up into fields with the <code>grok</code> command</li>
<li>Change the date field into Date Time that Solr will understand</li>
<li>Drop all of the extra fields that you did not specify in the schema.xml file</li>
<li>Generate the Indexes and send them to Solr</li>
</ol>
</ol>
<p>One powerful feature of Cloudera Search is that the morphline file, which encodes the transformation logic, is identical in both examples.</p>
<p>For completeness, here is the section in <a href="https://github.com/jshmain/cloudera-search/blob/master/email-search/flume.config">Flume configuration</a> that defines Solr Sink:</p>
<pre class="code" style="padding-left: 10px;"># SOLR Sink
tier1.sinks.solrSink.type=org.apache.flume.sink.solr.morphline.MorphlineSolrSink
tier1.sinks.solrSink.channel=solrChannel
tier1.sinks.solrSink.morphlineFile=/tmp/morphline.conf
</pre>
<p>&nbsp;</p>
<h2>How to Search and View Indexed Data</h2>
<p>Once the data is indexable and accessible by Cloudera Search, there are many ways for users to interact with it, including the Solr GUI or the via <a href="http://blog.cloudera.com/blog/2013/06/demo-the-new-search-app-in-hue-2-4/">Hue’s Search application</a>, which provides a very rich and configurable interface with faceting, date ranges and much more. </p>
<p align="center"><a href="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain5.png"><img title="shmain5" src="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain5.png" alt="" width="500" height="313" /></a><br /> <strong>Solr GUI</strong></p>
<p align="center"> </p>
<p align="center"><a href="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain6.png"><img title="shmain6" src="http://blog.cloudera.com/wp-content/uploads/2013/09/shmain6.png" alt="" width="500" height="313" /></a></p>
<p align="center"><strong>Hue’s Search app</strong></p>
<p>I could spend a significant amount of time describing Search visualization tools, but that is a matter for another post. </p>
<h2>Conclusion</h2>
<p>To summarize, here are the important steps an enterprise can take to get more value from its email data:</p>
<ul>
<li>Decide which email fields are to be extracted and indexed.</li>
<li>Use Morphlines to help with transformations. (No coding required!)</li>
<li>Use MapReduceIndexerTool to index the emails in HDFS.</li>
<li>Use Flume with MorphlineSolrSink to index the emails in near real time.</li>
</ul>
<p>The big news is that with Cloudera Search, indexing and searching various types of data over small and large data sets has become much easier and much more flexible. We have all learned to search the internet for information by using popular tools like Google and Yahoo!. Now, this tool is available for data in your Hadoop and HBase environments &#8211; and conveniently provides a more integrated and unified process. You will be able to find your data and process it on the same platform, without having to switch context or move your data. </p>
<p><em>Jeff Shmain is a solution architect at Cloudera.</em></p>

				<div class="social-buttons">
<span class='st_facebook_large' displayText='Facebook'></span>
<span class='st_twitter_large' displayText='Tweet'></span>
<span class='st_linkedin_large' displayText='LinkedIn'></span>
<span class='st_googleplus_large' displayText='Google +'></span>
<span class='st_email_large' displayText='Email'></span>
				</div>
			</div>

			<div class="grid_2" style="margin:0">
  <div class="comments comments-2">
    <div class="field-under">
      <h4>Filed under:</h4>
      <ul class="post-categories">
	<li><a href="http://blog.cloudera.com/blog/category/flume/" title="View all posts in Flume" rel="category tag">Flume</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/hadoop/" title="View all posts in Hadoop" rel="category tag">Hadoop</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/kite-sdk/" title="View all posts in Kite SDK" rel="category tag">Kite SDK</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/search/" title="View all posts in Search" rel="category tag">Search</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/use-case/" title="View all posts in Use Case" rel="category tag">Use Case</a></li></ul>  	</div>
  	
  <a name="comments"></a>
  <div class="comments-head">
    <strong>3 Responses</strong>
   
  </div>
  <ul class="comments-list">
  	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Jeremy Cunningham</a> /
			October 07, 2013 / 12:34 PM		</em>
		<p>Can this method index attachments?  For example, if I have a MS Word or document attached, will it be indexed? If so, how many attachments deep will it go if my attachments have attachments?</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Jeff Shmain</a> /
			October 08, 2013 / 4:36 PM		</em>
		<p>Theoretically that should work with some modifications.  Morphlines have the ability to use Apache Tikka to process pdfs, word docs, etc&#8230;</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Jeff Shmain</a> /
			November 09, 2013 / 7:48 PM		</em>
		<p>If you have an email with multiple attachments, a single morphlines configuration file can be used to handle multiple heterogenous input formats.  For example the following commands can be used:  &#8220;tryRules&#8221; , &#8220;if&#8221; command, or something similar similar.</p>
<p><a href="http://cloudera.github.io/cdk/docs/current/cdk-morphlines/morphlinesReferenceGuide.html#tryRules" rel="nofollow">http://cloudera.github.io/cdk/docs/current/cdk-morphlines/morphlinesReferenceGuide.html#tryRules</a></p>
<p><a href="http://cloudera.github.io/cdk/docs/current/cdk-morphlines/morphlinesReferenceGuide.html#if" rel="nofollow">http://cloudera.github.io/cdk/docs/current/cdk-morphlines/morphlinesReferenceGuide.html#if</a></p>
	</li>
</li>
  </ul>
  <a name="leave-comment"></a>
  <form action="/wp-comments-post.php" method="POST">
  	<div class="comment-form">
  		<h4>Leave a comment</h4>
  		<div class="row">
  			<input type="text" value="" class="txt" name="author"/>
  			<label>Name <span>required</span></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="email"/>
  			<label class="published">Email <span>required</span> <em>(will not be published)</em></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="url"/>
  			<label>Website</label>
  		</div>
  		<div class="row">
  			<textarea rows="10" cols="30" class="area" name="comment"></textarea>
  			<label>Comment</label>
  		</div>
  		<fieldset>
  			<input type="button" value="Leave Comment" class="btn cta"/>
  		</fieldset>
  	</div>
  	<input type='hidden' name='comment_post_ID' value='23233' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
  	<p class="cptch_block"><label>Prove you're human!<span class="required"> *</span></label><br />		<input type="hidden" name="cptch_result" value="k4c=" />
		<input type="hidden" name="cptch_time" value="1398162678" />
		<input type="hidden" value="Version: 2.4" />
		<input id="cptch_input" type="text" autocomplete="off" name="cptch_number" value="" maxlength="2" size="2" aria-required="true" required="required" style="margin-bottom:0;display:inline;font-size: 12px;width: 40px;" /> &#43; 6 =  ni&#110;e	</p>  </form>
</div></section>




<!-- Google Code for New Remarketing Pixel -->
<!-- Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. For instructions on adding this tag and more information on the above requirements, read the setup guide: google.com/ads/remarketingsetup -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 1035979479;
var google_conversion_label = "xel9CJ-P0QMQ15X_7QM";
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>

<noscript>
<div style="display:inline;"> <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1035979479/?value=0&label=xel9CJ-P0QMQ15X_7QM&guid=ON&script=0"/> </div>
</noscript>
</section>
<span class="bg-fix"></span>
</div>
</div>
<footer id="global-footer">
<div class="footerContent parbase">
<footer>
  <div class="wrapper">
    <div class="bg-fix"></div>
    <nav>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/products-and-services.html">Products</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products/cloudera-enterprise.html">Cloudera Enterprise</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-express.html">Cloudera Express</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-enterprise/cloudera-manager.html">Cloudera Manager</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cdh.html">CDH</a></li>
        <li><a href="http://www.cloudera.com/content/support/en/downloads.html">All Downloads</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/professional-services.html">Professional Services</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/training.html">Training</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/solutions.html">Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/enterprise-solutions.html">Enterprise Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/partner.html">Partner Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/industries.html">Industry Solutions</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/partners.html">Partners</a></li>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/resources/library.html">Resource Library</a></li>
        <li class="section"><a href="https://ccp.cloudera.com/display/SUPPORT/Get+Support">Support</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/about.html">About</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/hadoop-and-big-data.html">Hadoop &amp; Big Data</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/management.html">Management Team</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/board.html">Board</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/events.html">Events</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/press-center.html">Press Center</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/careers.html">Careers</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/contact-form.html">Contact Us</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/subscription-center.html">Subscription Center</a></li>
      </ul>
      <div class="locale-and-social" style="float:right">
        <div>
          <div class="locale-and-social">
            <div class="locale">
              <select onchange="this.options[this.selectedIndex].value &amp;&amp; (window.location = this.options[this.selectedIndex].value);" class="site-language">
                <option value="http://www.cloudera.com" name="English">English</option>
                <option value="http://www.cloudera.co.jp/">Japanese</option>
              </select>
            </div>
            <div class="social"><span class="follow">Follow us:</span><span class="share">Share:<i class="icon-share"></i></span>
              <ul>
                <li><a class="linkedIn" target="_blank" href="http://www.linkedin.com/company/cloudera">LinkedIn</a></li>
                <li><a class="twitter" target="_blank" href="http://twitter.com/cloudera">Twitter</a></li>
                <li><a class="facebook" target="_blank" href="http://www.facebook.com/cloudera">Facebook</a></li>
                <li><a class="youtube" target="_blank" href="http://www.youtube.com/user/clouderahadoop">YouTube</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <nav class="global-footer"><span class="logo"><a>Cloudera</a></span>
      <address>
      <span>Cloudera, Inc.</span> <span><a target="_blank" href="http://www.google.com/maps?q=1001+Page+Mill+Rd,+Palo+Alto,+CA+94306">1001 Page Mill Road Bldg 2</a></span> <span>Palo Alto, CA 94304</span>
      </address>
      <address>
      <span><a href="http://www.cloudera.com">www.cloudera.com</a></span> <span>US: 1-888-789-1488</span> <span>Intl: 1-650-362-0488</span>
      </address>
      <div class="copyright"><span><span class="piped">©2014 Cloudera, Inc. All rights reserved</span><span class="piped"><a href="http://www.cloudera.com/content/cloudera/en/terms-of-service.html">Terms &amp; Conditions</a></span><a href="http://www.cloudera.com/content/cloudera/en/privacy-policy.html">Privacy Policy</a></span> <span>Hadoop and the Hadoop elephant logo are trademarks of the <a target="_blank" href="http://www.apache.org/">Apache Software Foundation</a>.</span></div>
    </nav>
  </div>
</footer>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.3.2'></script>
<div class="modal" style="display:none">
  <div id="password-required">
    <div class="inner"> </div>
  </div>
</div>
<div class="tooltip" class="tooltip" style="display:none">
</div>
<script type="text/javascript" src="http://dnn506yrbagrg.cloudfront.net/pages/scripts/0011/2160.js"></script>
<script type="text/javascript">var _kiq = _kiq || [];</script> 
<script type="text/javascript" src="http://s3.amazonaws.com/ki.js/14646/2Sr.js" async></script>
</body></html>
