<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
<title>Indexing Files via Solr and Java MapReduce | Cloudera Developer Blog</title>

<meta name="keywords" content="hadoop, hadoop training, cloudera, hadoop tutorial, hadoop certification, apache hadoop, hadoop download, big data, open source" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="msvalidate.01" content="8857B9071A02F989DE3F8BEE557BB584" />

<link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Cloudera" />

<meta property="og:title" content="Indexing Files via Solr and Java MapReduce"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://blog.cloudera.com/blog/2012/03/indexing-files-via-solr-and-java-mapreduce/"/>
<meta property="og:site_name" content="Cloudera Developer Blog"/>


<link rel="icon" href="/wp-content/themes/solutionset/assets/favicon.ico" type="image/x-icon" /> 
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/960.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/reset.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/all.css?20120620" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/wp.css?20120620" /> 

<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 8]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6-7.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 9]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie.css?20120605" media="screen"/><![endif]-->

<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/modernizr-2.6.1.min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4.4-more-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript"> jQuery.noConflict(); </script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery.colorbox-min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/global.js?20120605"></script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "ur-aa86c136-1042-b30d-950-dd905bb179a0", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>


<link rel="pingback" href="http://blog.cloudera.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Feed" href="http://blog.cloudera.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Comments Feed" href="http://blog.cloudera.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Indexing Files via Solr and Java MapReduce Comments Feed" href="http://blog.cloudera.com/blog/2012/03/indexing-files-via-solr-and-java-mapreduce/feed/" />
<link rel='stylesheet' id='prettify-gc-syntax-highlighter-css'  href='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='cptchStylesheet-css'  href='http://blog.cloudera.com/wp-content/plugins/captcha/css/style_wp_before_3.8.css?ver=3.3.2' type='text/css' media='all' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.cloudera.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.cloudera.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Cloudera Manager | Hadoop Service Monitoring Demo Video' href='http://blog.cloudera.com/blog/2012/02/cloudera-manager-hadoop-service-monitoring-demo-video/' />
<link rel='next' title='Thoughts on Cloudera and Cisco UCS reference architecture for Apache Hadoop' href='http://blog.cloudera.com/blog/2012/03/thoughts-on-cloudera-and-cisco-ucs-reference-architecture-for-hadoop/' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='http://blog.cloudera.com/blog/2012/03/indexing-files-via-solr-and-java-mapreduce/' />
<link rel='shortlink' href='http://blog.cloudera.com/?p=13314' />


<script type="text/javascript">
 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-2275969-16']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();
</script>


</head>
<body class="single single-post postid-13314 single-format-standard devcenter">
			
		
			
	<header id="site-head">
<nav class="properties">
            <div class="container">
                <ul>
                    <!--<li><a href="http://www.cloudera.com">Cloudera.com</a></li>-->
                     <!--<li><a href="http://university.cloudera.com">Cloudera University</a></li>
                   <li><a href="${config.LINK_CCP}/display/DOC/Documentation">Documentation</a></li>-->
                    <li><a id="support_home_page" href="http://cloudera.com/content/support/en/home.html" class="active">Support</a></li>
                    <li><a href="http://cloudera.com/content/dev-center/en/home.html">Developers</a></li>
                  <!--<li><a href="http://cloudera.com/content/cloudera/en/partners.html">PARTNERS</a></li>-->
                   
                </ul>
                <ul class="user">
                    <li>
                       <!--<a id="signinLink" class="hidden" href="https://clouderapkb.echolane.cs3.force.com/idp/login?app=0spQ00000004CD5">Sign In</a>-->
<a id="signinLink" class="hidden" href="https://cloudera.secure.force.com">Sign In</a>
                    </li>
                    <li><a id="registerLink" class="hidden" href="http://cloudera.com/content/support/en/user-registration.html">Register</a></li>
                    <li><a href="http://cloudera.com/content/cloudera/en/about/contact-us.html">Contact Us</a></li>
                    <li><a href="http://cloudera.com/content/support/en/downloads.html">Downloads</a></li>
                    <li>
                        <div id="dropdownAction" class="dropdown" style="display:none">
                            <a id="lnkDropdowntoogle" data-toggle="dropdown" class="dropdown-toggle" href="#">

                            </a>
                            <ul aria-labelledby="dropdownMenu" tole="menu" class="dropdown-menu">
                                <li><a href="http://cloudera.com/content/support/en/edit-user-profile.html" id="editProfileLink" tabindex="-1">Edit Profile</a></li>
                                <li class="divider"></li>
                                <li>
                                <a id="logoutLink" tabindex="-1" href="#">Logout</a>
                                </script>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="bg-fix"></div>
        </nav>
<!--</div>-->

<div class="wrapper">
    <div class="bg-fix"></div>
    <h1 class="logo">
        <a href="http://cloudera.com/content/cloudera/en/home.html">Cloudera</a>
    </h1>

<nav class="site">
        <ul>
    <li class="">
 <a href="http://community.cloudera.com" data-link="external">Community</a>
</li>
<li class="">
 <a href="http://cloudera.com/content/support/en/documentation.html" data-link="external">Documentation</a>
</li>
 <li class="">
                    <a href="http://cloudera.com/content/support/en/downloads.html" data-link="external">Downloads</a>
   </li>
     <li class="">
                    <a href="http://university.cloudera.com" data-link="external">Training</a>
     </li>
<li class="">
                    <a href="http://blog.cloudera.com" data-link="external" class="active">Blogs</a>
                    <nav class="subnav menu"> <nav><ul>
<li><a href="http://vision.cloudera.com">Cloudera Vision</a></li>
<!--<li><a href="http://blog.cloudera.com/blog">Developer Blog</a></li>-->
</ul>
</nav> </nav>
</li>
            
        </ul>
    </nav>


    <div class="form-holder">
		
	    <form action="http://cloudera.com/content/cloudera/en/search.html" id="site-search" method="get" novalidate> 
	        <label for="q" class="visuallyhidden">Search</label> 
	        <input type="search" name="q" id="q" placeholder="Search"><i class="icon-search"></i> 
	    </form>
    </div>
    </div><!--</div>-->
        </header>
				
	<div role="main" class="main">
		<div class="wrapper">
			<section class="two-col">

	
<aside class="left-col">

				<nav>
			<ul class=" ">
			
								
							<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/hadoop-and-big-data.html"
					title="Hadoop &amp; Big Data"
					class=""
					target="_blank"				>
					Hadoop &amp; Big Data				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/our-customers.html"
					title="Our Customers"
					class=""
					target="_blank"				>
					Our Customers				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/faqs.html"
					title="FAQs"
					class=""
					target="_blank"				>
					FAQs				</a>

							</li>
			
					<li class="current">
				<a
					href="/blog/"
					title="Blog"
					class="blog"
									>
					Blog				</a>

									<ul>
									<li class="">
				<a
					href="/blog/category/accumulo/"
					title="Accumulo (1)"
					class=""
									>
					Accumulo (1)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/avro/"
					title="Avro (16)"
					class=""
									>
					Avro (16)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/bigtop/"
					title="Bigtop (6)"
					class=""
									>
					Bigtop (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/books/"
					title="Books (6)"
					class=""
									>
					Books (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/careers/"
					title="Careers (14)"
					class=""
									>
					Careers (14)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cdh/"
					title="CDH (127)"
					class=""
									>
					CDH (127)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloud-2/"
					title="Cloud (9)"
					class=""
									>
					Cloud (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-life/"
					title="Cloudera Life (3)"
					class=""
									>
					Cloudera Life (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-manager/"
					title="Cloudera Manager (61)"
					class=""
									>
					Cloudera Manager (61)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/community/"
					title="Community (182)"
					class=""
									>
					Community (182)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-collection/"
					title="Data Collection (17)"
					class=""
									>
					Data Collection (17)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-science/"
					title="Data Science (26)"
					class=""
									>
					Data Science (26)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/distribution/"
					title="Distribution (36)"
					class=""
									>
					Distribution (36)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/events/"
					title="Events (37)"
					class=""
									>
					Events (37)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/flume/"
					title="Flume (18)"
					class=""
									>
					Flume (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/general/"
					title="General (327)"
					class=""
									>
					General (327)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/guest/"
					title="Guest (77)"
					class=""
									>
					Guest (77)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hadoop/"
					title="Hadoop (294)"
					class=""
									>
					Hadoop (294)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hardware/"
					title="Hardware (3)"
					class=""
									>
					Hardware (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hbase/"
					title="HBase (124)"
					class=""
									>
					HBase (124)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hdfs/"
					title="HDFS (45)"
					class=""
									>
					HDFS (45)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hive/"
					title="Hive (62)"
					class=""
									>
					Hive (62)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/how-to/"
					title="How-to (53)"
					class=""
									>
					How-to (53)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hue/"
					title="Hue (30)"
					class=""
									>
					Hue (30)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/impala/"
					title="Impala (63)"
					class=""
									>
					Impala (63)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/kite-sdk/"
					title="Kite SDK (11)"
					class=""
									>
					Kite SDK (11)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mahout-2/"
					title="Mahout (5)"
					class=""
									>
					Mahout (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mapreduce/"
					title="MapReduce (71)"
					class=""
									>
					MapReduce (71)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/meet-the-engineer/"
					title="Meet The Engineer (18)"
					class=""
									>
					Meet The Engineer (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/oozie/"
					title="Oozie (25)"
					class=""
									>
					Oozie (25)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/ops/"
					title="Ops And DevOps (19)"
					class=""
									>
					Ops And DevOps (19)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/pig/"
					title="Pig (35)"
					class=""
									>
					Pig (35)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/quickstart-vm/"
					title="QuickStart VM (5)"
					class=""
									>
					QuickStart VM (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/search/"
					title="Search (21)"
					class=""
									>
					Search (21)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/security-2/"
					title="Security (15)"
					class=""
									>
					Security (15)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/spark/"
					title="Spark (9)"
					class=""
									>
					Spark (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/sqoop/"
					title="Sqoop (20)"
					class=""
									>
					Sqoop (20)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/support/"
					title="Support (4)"
					class=""
									>
					Support (4)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/testing/"
					title="Testing (8)"
					class=""
									>
					Testing (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/this-month-in-the-ecosystem/"
					title="This Month In The Ecosystem (8)"
					class=""
									>
					This Month In The Ecosystem (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/tools/"
					title="Tools (6)"
					class=""
									>
					Tools (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/training-2/"
					title="Training (42)"
					class=""
									>
					Training (42)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/use-case/"
					title="Use Case (59)"
					class=""
									>
					Use Case (59)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/whirr/"
					title="Whirr (6)"
					class=""
									>
					Whirr (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/yarn/"
					title="YARN (13)"
					class=""
									>
					YARN (13)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/zookeeper/"
					title="ZooKeeper (24)"
					class=""
									>
					ZooKeeper (24)				</a>

							</li>
			
					<li class="">
				<a
					href="/archive/"
					title="Archives by Month"
					class=""
									>
					Archives by Month				</a>

							</li>
			
							</ul>
							</li>
			
						
			    
			
				<div style="clear:both"></div>
			</ul>
			</nav>
			<div class="menu-special">
				<ul>
							
				
				
		
				
		
				
				
				
				

		
					</ul>
			</div>
			
</aside>


<section>
			<h1 class="heading ">Indexing Files via Solr and Java MapReduce</h1>
			
			<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
			
			<ul class="post-info">
				<li>by <a href="http://blog.cloudera.com/blog/author/asmieszny/" title="Posts by Adam Smieszny" rel="author">Adam Smieszny</a></li>
				<li>March 02, 2012</li>
				<li class="comment"><a href="#comments">10 comments</a></li>
				
			</ul>
			
			<div class="text-block">
				<p>Several weeks ago, I set about to demonstrate the ease with which <a title="Solr" href="http://lucene.apache.org/solr/" target="_blank">Solr</a> and <a title="Cloudera Distribution Including Apache Hadoop" href="http://www.cloudera.com/hadoop/" target="_blank">Map/Reduce</a> can be integrated. I was unable to find a simple, yet comprehensive, primer on integrating the two technologies. So I set about to write one.</p>
<p>What follows is my bare-bones tutorial on getting Solr up and running to index each word of the complete works of Shakespeare. Note: Special thanks to <a title="Sematext - Solr experts." href="http://sematext.com/" target="_blank">Sematext</a> for looking over the Solr bits and making sure they are sane. Check them out if you’re going to be doing a lot of work with Solr, ElasticSearch, or search in general and want to bring in the experts.</p>
<h2 style="font-size:13pt">First things first</h2>
<p>The way that I got started was by instantiating a new CentOS 6 Virtual Machine. You can pick a different flavor of Linux if that suits you; Hadoop <em>should</em> work fine on any (though advocated distros are SuSE, Ubuntu/Debian, RedHat/CentOS).</p>
<p>If you are fine with CentOS and want to skip some of the manual labor here, you can download a pre-loaded Virtual Machine from the <a title="Cloudera Downloads" href="https://ccp.cloudera.com/display/SUPPORT/Downloads" target="_blank">Cloudera Downloads section</a>, that already includes an installation of Sun Java 6u21 and CDH3u3. You can then skip ahead to installing Solr and downloading sample data as outlined below.</p>
<p>If you are proceeding with a new (virtual) machine, then follow along as follows: Make sure to disable SELinux, if applicable, and enable sshd. For CentOS6, that was done with the following commands:</p>
<pre class="code">[user@localhost ~]$ sudo chkconfig --levels 2345 sshd on
[user@localhost ~]$ /etc/init.d/sshd start
[user@localhost ~]$ vim /etc/selinux/config [set to disabled]</pre>
<p style="padding-top:10px">On that machine, download and install:</p>
<ul>
<li><strong>Java</strong> &#8211; I&#8217;d recommend Java 6u26 as it has been tested with CDH<br /> <a href="http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html">http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html<br /> </a>Oracle Java never seems to play nicely with the /etc/alternative system (in my experience), so I force it to be the preferred JRE the old fashioned way:</li>
</ul>
<pre class="code">[user@localhost ~]$ sudo rm /usr/bin/java
[user@localhost ~]$ sudo ln -s /usr/java/jdk1.6.0_26/jre/bin/java \
 /usr/bin/java</pre>
<ul style="padding-top:10px">
<li><strong>Solr</strong> &#8211; download and unzip/untar in whatever directory that you like. For the purpose of this article, I&#8217;ll refer to it as <br /> <a href="http://lucene.apache.org/solr/downloads.html">http://lucene.apache.org/solr/downloads.html</a></li>
<li><strong>Hadoop</strong> &#8211; I am, obviously, biased. But my recommendation would be to use Cloudera Manager (free up to 50 nodes) to set up your VM as a <a href="http://hadoop.apache.org/common/docs/r0.20.2/quickstart.html" target="_blank">pseudo-distributed cluster</a><br /> <a href="http://www.cloudera.com/products-services/tools/">http://www.cloudera.com/products-services/tools/</a></li>
<li><strong>Sample data</strong> &#8211; Complete works of William Shakespeare. I&#8217;d recommend unzipping into a single directory. I&#8217;ll refer to it as <br /> <a href="http://www.ipl.org/div/shakespeare/">http://www.ipl.org/div/shakespeare/</a></li>
</ul>
<p>You can validate that all of the pieces are installed and running correctly by doing the following:</p>
<ul>
<li><strong>Java</strong></li>
</ul>
<pre class="code">[user@localhost ~]$ java -version
java version "1.6.0_21"
Java(TM) SE Runtime Environment (build 1.6.0_21-b06)
Java HotSpot(TM) 64-Bit Server VM (build 17.0-b16, mixed mode)</pre>
<ul style="padding-top:10px">
<li><strong>Solr</strong></li>
</ul>
<pre class="code">[user@localhost ~]$ cd /example
[user@localhost ~]$ java -jar start.jar</pre>
<p style="padding-top:10px">The goal is to get up and running quickly here, so I am opting to use the Solr example configuration. Worth noting also that when run in this manner, the Solr server will be started with the default JVM heap size &#8211; which I believe to be the smaller of {1/4 system memory or 1GB}.</p>
<p>Now, you should be able to access the Solr administration GUI (one of the niceties of Solr!) via a web browser inside your VM with the address: http://localhost:8983/solr/admin</p>
<ul>
<li><strong>Hadoop</strong></li>
</ul>
<p>You can validate that Hadoop is installed and running successfully by navigating in your VM&#8217;s browser to: http://localhost:7180, logging in as admin/admin, and seeing the following:</p>
<p><a href="http://www.cloudera.com/wp-content/uploads/2012/03/healthy_hadoop_scm.png"><img class="alignnone size-full wp-image-13316" src="http://www.cloudera.com/wp-content/uploads/2012/03/healthy_hadoop_scm.png" alt="A Healthy Hadoop (pseudo)cluster" width="899" height="295" /></a></p>
<p>You probably want to export the client config XML files (can be done with a single click via Cloudera Manager &#8211; see the Generate Client Configuration buttong), copy them to /usr/lib/hadoop/conf, and then copy the sample text into hdfs:</p>
<pre class="code">[user@localhost ~]$ hadoop fs -put &lt;shakespeare&gt; shakespeare</pre>
<h2 style="padding-top:10px;font-size:13pt">Creating the indexing code</h2>
<p>I have some history with Lucene from a past life, so the high level functionality of Solr was familiar to me. In a nutshell, you index files within Java code by creating a SolrInputDocument, which represents a single entity to index &#8211; a file or document generally &#8211; and using the .addField() to attach fields to this document that you&#8217;d later like to search.</p>
<p>The driver code for the indexer is very simple, in that it takes input file path(s) off the command line, and runs the mapper on the files that it finds. Note that it will accept a directory, and parse all of the files that it finds within.</p>
<pre class="code">public class IndexDriver extends Configured implements Tool {     

  public static void main(String[] args) throws Exception {
    //TODO: Add some checks here to validate the input path
    int exitCode = ToolRunner.run(new Configuration(),
     new IndexDriver(), args);
    System.exit(exitCode);
  }

  @Override
  public int run(String[] args) throws Exception {
    JobConf conf = <strong>new</strong> JobConf(getConf(), IndexDriver.<strong>class</strong>);
    conf.setJobName("Index Builder - Adam S @ Cloudera");
    conf.setSpeculativeExecution(<strong>false</strong>);

    // Set Input and Output paths
    FileInputFormat.<em>setInputPaths</em>(conf, <strong>new</strong> Path(args[0].toString()));
    FileOutputFormat.<em>setOutputPath</em>(conf, <strong>new</strong> Path(args[1].toString()));
    // Use TextInputFormat
    conf.setInputFormat(TextInputFormat.<strong>class</strong>);

    // Mapper has no output
    conf.setMapperClass(IndexMapper.<strong>class</strong>);
    conf.setMapOutputKeyClass(NullWritable.<strong>class</strong>);
    conf.setMapOutputValueClass(NullWritable.<strong>class</strong>);
    conf.setNumReduceTasks(0);
    JobClient.<em>runJob</em>(conf);
    <strong>return</strong> 0;
  }
}</pre>
<p style="padding-top:10px">The Map code is where things get more interesting. A couple notes before we proceed:</p>
<p><em>Solr servers may be used in 2 ways:</em></p>
<ol>
<li>Via embedding a Solr server object within your Java code using EmbeddedSolrServer</li>
<li>Via HTTP requests, using the class CommonsHttpSolrServer with a URL (in our case, http://localhost:8983/solr)</li>
</ol>
<p>In what follows, I elected to go with the <a title="JavaDoc for SUSS" href="http://lucene.apache.org/solr/api/org/apache/solr/client/solrj/impl/StreamingUpdateSolrServer.html" target="_blank">StreamingUpdateSolrServer</a> &#8211; which is a subclass of CommonsHttpSolrServer. More comments on that towards the end.</p>
<p><em>I will assume now that the reader has some familiarity with the Map/Reduce programming paradigm.</em> The salient points for us here are that we will use a Map-only job to read through each file in the input that we provide, and index our chosen fields. Taking the path of least resistance, I used the fact that each line of text is it&#8217;s own Key/Value pair if we read the input as TextInputFormat, and I chose to index the following fields:</p>
<ol>
<li>As a unique identifier for each word, I concatenated the filename, line offset (conveniently provided to the Map code as the &#8220;Key&#8221; because we are using TextInputFormat), and the position on that line of the word</li>
<li>The word itself</li>
</ol>
<p><em>The Solr server obeys field definitions (specifying field names, data types, uniqueness, etc.) as dictated by a schema file.</em> For this example, running Solr as indicated above, the schema is defined by/example/solr/conf/schema.xml</p>
<p>Per my choice to index 2 distinct fields, the relevant fields in the schema are:</p>
<pre class="code">&lt;field name="id" type="string" indexed="true" \
 stored="true" required="true" /&gt;
&lt;field name="text" type="text_general" indexed="true" \
 stored="true" multiValued="true"/&gt;</pre>
<p style="padding-top:10px">Without further ado, then, the code looks like the following:</p>
<pre class="code">public class IndexMapper extends MapReduceBase implements
 Mapper &lt;LongWritable, Text, NullWritable, NullWritable&gt; {
  <strong>private</strong> StreamingUpdateSolrServer server = null;
  <strong>private</strong> SolrInputDocument thisDoc = new SolrInputDocument();
  <strong>private</strong> String fileName;
  <strong>private</strong> StringTokenizer st = null;
  <strong>private</strong> int lineCounter = 0;

  @Override
  <strong>public</strong> <strong>void</strong> configure(JobConf job) {
    String url = "http://localhost:8983/solr";
    fileName = job.get("map.input.file").substring(
      (job.get("map.input.file")).lastIndexOf(
      System.getProperty("file.separator")) +1);
      <strong>try</strong> {
        server = <strong>new</strong> StreamingUpdateSolrServer(url, 100, 5);
      } <strong>catch</strong> (MalformedURLException e) {
        e.printStackTrace();
      }
  }

  @Override
  <strong>public</strong> <strong>void</strong> map(LongWritable key, Text val,
   OutputCollector &lt;NullWritable, NullWritable&gt; output,
   Reporter reporter) <strong>throws</strong> IOException {

    st = <strong>new</strong> StringTokenizer(val.toString());
    lineCounter = 0;
    <strong>while</strong> (st.hasMoreTokens()) {
      thisDoc = <strong>new</strong> SolrInputDocument();
      thisDoc.addField("id", fileName + " "
       + key.toString() + " " + lineCounter++);
      thisDoc.addField("text", st.nextToken());
      <strong>try</strong> {
        server.add(thisDoc);
      } <strong>catch</strong> (SolrServerException e) {
        e.printStackTrace();
      } <strong>catch</strong> (IOException e) {
        e.printStackTrace();
      }
    }
  }

  @Override
  <strong>public</strong> <strong>void</strong> close() <strong>throws</strong> IOException {
  <strong>try</strong> {
      server.commit();
    } <strong>catch</strong> (SolrServerException e) {
      e.printStackTrace();
    }
  }
}</pre>
<p style="padding-top:10px">Compile the code how you see fit (I am old school and still use ant), and the job is ready to run!</p>
<p>To index all of the comedies, you can run the job with the compiled jar file as follows. Note that you must tell hadoop to include an additional Solr jar at runtime:</p>
<pre class="code">[user@localhost SolrTest]$ hadoop jar solrtest.jar \
 -libjars &lt;solr_install_dir&gt;/dist/apache-solr-solrj-3.5.0.jar \
 shakespeare/comedies shakespeare_output</pre>
<p style="padding-top:10px">If you then query the Solr server (via the web GUI at http://localhost:8983/solr/admin, the default search is *:* which works well for a quick test) you should see something like the following:</p>
<pre class="code">&lt;response&gt;
 &lt;lst name="responseHeader"&gt;
  &lt;int name="status"&gt;0&lt;/int&gt;
  &lt;int name="QTime"&gt;35&lt;/int&gt;
  &lt;lst name="params"&gt;
    &lt;str name="indent"&gt;on&lt;/str&gt;
    &lt;str name="start"&gt;0&lt;/str&gt;
    &lt;str name="q"&gt;*:*&lt;/str&gt;
    &lt;str name="version"&gt;2.2&lt;/str&gt;
    &lt;str name="rows"&gt;10&lt;/str&gt;
  &lt;/lst&gt;
 &lt;/lst&gt;
&lt;result name="response" numFound="377452" start="0"&gt;
&lt;doc&gt;
 &lt;str name="id"&gt;troilusandcressida 0 0&lt;/str&gt;
 &lt;arr name="text"&gt;
  &lt;str&gt;TROILUS&lt;/str&gt;
 &lt;/arr&gt;
&lt;/doc&gt;
&lt;doc&gt;
 &lt;str name="id"&gt;troilusandcressida 0 1&lt;/str&gt;
 &lt;arr name="text"&gt;
  &lt;str&gt;AND&lt;/str&gt;
 &lt;/arr&gt;
&lt;/doc&gt;
&lt;doc&gt;
 &lt;str name="id"&gt;troilusandcressida 0 2&lt;/str&gt;
 &lt;arr name="text"&gt;
  &lt;str&gt;CRESSIDA&lt;/str&gt;
 &lt;/arr&gt;
&lt;/doc&gt;</pre>
<p>&#8230;</p>
<h2 style="font-size:13pt">Further Tuning/Investigation Opportunities</h2>
<p><em>Performance Implications of StreamingUpdateSolrServer &#8211; possibility of using EmbeddedSolrServer:</em> What are the optimal tuning parameters for number of threads and batch size when using StreamingUpdateSolrServer? More investigation could be done here. It is also possible to use an EmbeddedSolrServer (per the Rackspace case study in <a href="http://www.amazon.com/Hadoop-Definitive-Guide-Tom-White/dp/1449389732/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1330367237&amp;sr=1-1" target="_blank" title="Hadoop: The Definitive Guide">Hadoop: The Definitive Guide</a>), though it does add some maintenance overhead to create the indexes in a distributed fashion and then later re-combine. I opted to use the StreamingUpdateSolrServer because I believe that it is simpler to get up and running in a small test environment.</p>
<p><em>How to minimize the memory requirements in the Map code:</em> I haven&#8217;t been a full time Java developer in many years, so there are almost certainly things that I&#8217;m missing on how to minimize the memory overhead of the objects used in the Map code. Since this is called for each line in the input, it is critical to make this code as lean as possible. One tip that I came across on this topic is to use (mutable) org.apache.hadoop.io.Text objects rather than (immutable) Strings. I avoided creating any new String objects in this example Map code, but the point is worth noting for other exercises.</p>
<h2 style="font-size:13pt">Resources that I found useful</h2>
<ul>
<li>A great primer that accomplished the indexing via Cascading:<br /> <a href="http://architects.dzone.com/articles/solr-hadoop-big-data-love">http://architects.dzone.com/articles/solr-hadoop-big-data-love</a></li>
<li>Solr Tutorial:<br /> <a href="http://lucene.apache.org/solr/tutorial.html">http://lucene.apache.org/solr/tutorial.html</a></li>
<li>Some sample code for adding, updating, deleting documents on this wiki:<br /> <a href="http://wiki.apache.org/solr/Solrj">http://wiki.apache.org/solr/Solrj</a></li>
<li><a href="http://www.cloudera.com/company/careers/" title="Cloudera Careers">My outstanding coworkers at Cloudera!</a></li>
</ul>

				<div class="social-buttons">
<span class='st_facebook_large' displayText='Facebook'></span>
<span class='st_twitter_large' displayText='Tweet'></span>
<span class='st_linkedin_large' displayText='LinkedIn'></span>
<span class='st_googleplus_large' displayText='Google +'></span>
<span class='st_email_large' displayText='Email'></span>
				</div>
			</div>

			<div class="grid_2" style="margin:0">
  <div class="comments comments-2">
    <div class="field-under">
      <h4>Filed under:</h4>
      <ul class="post-categories">
	<li><a href="http://blog.cloudera.com/blog/category/cdh/" title="View all posts in CDH" rel="category tag">CDH</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/cloudera-manager/" title="View all posts in Cloudera Manager" rel="category tag">Cloudera Manager</a></li></ul>  	</div>
  	
  <a name="comments"></a>
  <div class="comments-head">
    <strong>10 Responses</strong>
   
  </div>
  <ul class="comments-list">
  	<li>
		<em class="comment-date">
			<a rel="nofollow" href="http://www.datasalt.com/blog/">Pere</a> /
			March 02, 2012 / 8:15 AM		</em>
		<p>Hi,<br />
Good article.<br />
In the article you mention that using EmbeddedSolr &#8220;adds some maintenance overhead to create the indexes in a distributed fashion and then later re-combine&#8221;. I would like to point out that it has some advantages as well. On one hand it allows you to create the index in a completely distributed fashion. Using Map and Reduce phases allows you to shuffle your documents (preparing them better for a sharding environment). It is a batch indexing strategy that completely decouples the frontend with the backend &#8211; boosting the performance of both parts. Finally, it allows you do to deploy the index atomically, leveraging Solr&#8217;s core swap and rollback mechanisms. We have previously published an article in our blog in the past that explains how to buid &#8220;frontend views&#8221; in a completely distributed way using this philosophy: <a href="http://www.datasalt.com/2011/10/front-end-view-generation-with-hadoop/" rel="nofollow">http://www.datasalt.com/2011/10/front-end-view-generation-with-hadoop/</a> . We thought this would be meaningful to the article.</p>
<p>Cheers.</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">terrence pietrondi</a> /
			March 26, 2012 / 8:24 PM		</em>
		<p>In this example, what purpose does &#8220;shakespeare_output&#8221; serve when running the job since the output is the solr document?</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Adam Smieszny</a> /
			March 27, 2012 / 5:16 AM		</em>
		<p>@Terrence Pietrondi:<br />
Hi Terrence. The shakespeare_output directory in HDFS will hold some metadata that is generated by MapReduce. In particular, a file named _SUCCESS that will indicate if the job completed successfully. It will also contain (empty) files names part_0000x, that are empty because we don&#8217;t emit anything from our code.</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">terrence pietrondi</a> /
			March 30, 2012 / 10:11 AM		</em>
		<p>What are the suggested specs on the cloudera traning vm image, when attempting this tutorial, the process ran out of memory. I gave it two processors and 4080 of memory. My host machine is a mac ox s 10.6.8, 2.66 GHz intel core 2 due, 8 gig memory.</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="http://www.likethecolor.com">Dan Brown</a> /
			April 01, 2012 / 8:22 AM		</em>
		<p>A while back we had the need to generate indexes via M/R (solr 1.3).  I&#8217;ve documented the details here: <a href="http://www.likethecolor.com/2010/09/26/using-hadoop-to-create-solr-indexes/" rel="nofollow">http://www.likethecolor.com/2010/09/26/using-hadoop-to-create-solr-indexes/</a>  Thought I might be useful to others here.  I would love any suggestions.  Thanks.</p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Adam Smieszny</a> /
			April 01, 2012 / 8:39 AM		</em>
		<p>@ Terrence Pietrondi:<br />
Hi Terrence. If you find that the process runs out of memory, most likely the issue doesn&#8217;t have to do with the VM specs (what you have sounds like plenty of CPU and RAM available).<br />
Rather, it probably requires increasing the memory allocated for the MapReduce processes.<br />
If you are using Cloudera Manager, modifying this configuration is quite simple. Please view the following video for more information:<br />
<a href="http://www.cloudera.com/resource/cloudera-manager-service-and-configuration-management-part-1/" rel="nofollow">http://www.cloudera.com/resource/cloudera-manager-service-and-configuration-management-part-1/</a></p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">terrence pietrondi</a> /
			April 06, 2012 / 7:59 AM		</em>
		<p>I was able to get the demo running after rebooting the vmware. For anyone looking, here is the build file I used: </p>
<p><a href="https://github.com/tepietrondi/oddsandendsrandomcode/blob/master/cloudera-hadoop-solr-test/build.xml" rel="nofollow">https://github.com/tepietrondi/oddsandendsrandomcode/blob/master/cloudera-hadoop-solr-test/build.xml</a></p>
	</li>
</li>
	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Pravin</a> /
			June 10, 2012 / 11:18 AM		</em>
		<p>Very useful article.</p>
<p>Thanks for sharing.</p>
	</li>
</li>
  </ul>
  <a name="leave-comment"></a>
  <form action="/wp-comments-post.php" method="POST">
  	<div class="comment-form">
  		<h4>Leave a comment</h4>
  		<div class="row">
  			<input type="text" value="" class="txt" name="author"/>
  			<label>Name <span>required</span></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="email"/>
  			<label class="published">Email <span>required</span> <em>(will not be published)</em></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="url"/>
  			<label>Website</label>
  		</div>
  		<div class="row">
  			<textarea rows="10" cols="30" class="area" name="comment"></textarea>
  			<label>Comment</label>
  		</div>
  		<fieldset>
  			<input type="button" value="Leave Comment" class="btn cta"/>
  		</fieldset>
  	</div>
  	<input type='hidden' name='comment_post_ID' value='13314' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
  	<p class="cptch_block"><label>Prove you're human!<span class="required"> *</span></label><br />		<input type="hidden" name="cptch_result" value="zOo=" />
		<input type="hidden" name="cptch_time" value="1398162883" />
		<input type="hidden" value="Version: 2.4" />
		&#115;i&#120; &minus; 4 =  <input id="cptch_input" type="text" autocomplete="off" name="cptch_number" value="" maxlength="2" size="2" aria-required="true" required="required" style="margin-bottom:0;display:inline;font-size: 12px;width: 40px;" />	</p>  </form>
</div></section>




<!-- Google Code for New Remarketing Pixel -->
<!-- Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. For instructions on adding this tag and more information on the above requirements, read the setup guide: google.com/ads/remarketingsetup -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 1035979479;
var google_conversion_label = "xel9CJ-P0QMQ15X_7QM";
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>

<noscript>
<div style="display:inline;"> <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1035979479/?value=0&label=xel9CJ-P0QMQ15X_7QM&guid=ON&script=0"/> </div>
</noscript>
</section>
<span class="bg-fix"></span>
</div>
</div>
<footer id="global-footer">
<div class="footerContent parbase">
<footer>
  <div class="wrapper">
    <div class="bg-fix"></div>
    <nav>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/products-and-services.html">Products</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products/cloudera-enterprise.html">Cloudera Enterprise</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-express.html">Cloudera Express</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-enterprise/cloudera-manager.html">Cloudera Manager</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cdh.html">CDH</a></li>
        <li><a href="http://www.cloudera.com/content/support/en/downloads.html">All Downloads</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/professional-services.html">Professional Services</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/training.html">Training</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/solutions.html">Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/enterprise-solutions.html">Enterprise Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/partner.html">Partner Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/industries.html">Industry Solutions</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/partners.html">Partners</a></li>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/resources/library.html">Resource Library</a></li>
        <li class="section"><a href="https://ccp.cloudera.com/display/SUPPORT/Get+Support">Support</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/about.html">About</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/hadoop-and-big-data.html">Hadoop &amp; Big Data</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/management.html">Management Team</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/board.html">Board</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/events.html">Events</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/press-center.html">Press Center</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/careers.html">Careers</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/contact-form.html">Contact Us</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/subscription-center.html">Subscription Center</a></li>
      </ul>
      <div class="locale-and-social" style="float:right">
        <div>
          <div class="locale-and-social">
            <div class="locale">
              <select onchange="this.options[this.selectedIndex].value &amp;&amp; (window.location = this.options[this.selectedIndex].value);" class="site-language">
                <option value="http://www.cloudera.com" name="English">English</option>
                <option value="http://www.cloudera.co.jp/">Japanese</option>
              </select>
            </div>
            <div class="social"><span class="follow">Follow us:</span><span class="share">Share:<i class="icon-share"></i></span>
              <ul>
                <li><a class="linkedIn" target="_blank" href="http://www.linkedin.com/company/cloudera">LinkedIn</a></li>
                <li><a class="twitter" target="_blank" href="http://twitter.com/cloudera">Twitter</a></li>
                <li><a class="facebook" target="_blank" href="http://www.facebook.com/cloudera">Facebook</a></li>
                <li><a class="youtube" target="_blank" href="http://www.youtube.com/user/clouderahadoop">YouTube</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <nav class="global-footer"><span class="logo"><a>Cloudera</a></span>
      <address>
      <span>Cloudera, Inc.</span> <span><a target="_blank" href="http://www.google.com/maps?q=1001+Page+Mill+Rd,+Palo+Alto,+CA+94306">1001 Page Mill Road Bldg 2</a></span> <span>Palo Alto, CA 94304</span>
      </address>
      <address>
      <span><a href="http://www.cloudera.com">www.cloudera.com</a></span> <span>US: 1-888-789-1488</span> <span>Intl: 1-650-362-0488</span>
      </address>
      <div class="copyright"><span><span class="piped">©2014 Cloudera, Inc. All rights reserved</span><span class="piped"><a href="http://www.cloudera.com/content/cloudera/en/terms-of-service.html">Terms &amp; Conditions</a></span><a href="http://www.cloudera.com/content/cloudera/en/privacy-policy.html">Privacy Policy</a></span> <span>Hadoop and the Hadoop elephant logo are trademarks of the <a target="_blank" href="http://www.apache.org/">Apache Software Foundation</a>.</span></div>
    </nav>
  </div>
</footer>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.3.2'></script>
<div class="modal" style="display:none">
  <div id="password-required">
    <div class="inner"> </div>
  </div>
</div>
<div class="tooltip" class="tooltip" style="display:none">
</div>
<script type="text/javascript" src="http://dnn506yrbagrg.cloudfront.net/pages/scripts/0011/2160.js"></script>
<script type="text/javascript">var _kiq = _kiq || [];</script> 
<script type="text/javascript" src="http://s3.amazonaws.com/ki.js/14646/2Sr.js" async></script>
</body></html>
