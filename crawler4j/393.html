<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
<title>Process a Million Songs with Apache Pig | Cloudera Developer Blog</title>

<meta name="keywords" content="hadoop, hadoop training, cloudera, hadoop tutorial, hadoop certification, apache hadoop, hadoop download, big data, open source" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="msvalidate.01" content="8857B9071A02F989DE3F8BEE557BB584" />

<link rel="search" type="application/opensearchdescription+xml" href="/assets/opensearch.xml" title="Cloudera" />

<meta property="og:title" content="Process a Million Songs with Apache Pig"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://blog.cloudera.com/blog/2012/08/process-a-million-songs-with-apache-pig/"/>
<meta property="og:site_name" content="Cloudera Developer Blog"/>


<link rel="icon" href="/wp-content/themes/solutionset/assets/favicon.ico" type="image/x-icon" /> 
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/960.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/reset.css?070910" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/all.css?20120620" />
<link rel="stylesheet" media="all" type="text/css" href="/wp-content/themes/solutionset/assets/css/wp.css?20120620" /> 

<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 8]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie6-7.css?20120605" media="screen"/><![endif]-->
<!--[if lt IE 9]><link rel="stylesheet" type="text/css" href="http://blog.cloudera.com/wp-content/themes/solutionset/assets/css/ie.css?20120605" media="screen"/><![endif]-->

<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/modernizr-2.6.1.min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/mootools-1.2.4.4-more-yui.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery-1.6.2.min.js"></script>
<script type="text/javascript"> jQuery.noConflict(); </script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/jquery.colorbox-min.js"></script>
<script type="text/javascript" src="/wp-content/themes/solutionset/assets/js/global.js?20120605"></script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "ur-aa86c136-1042-b30d-950-dd905bb179a0", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>


<link rel="pingback" href="http://blog.cloudera.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Feed" href="http://blog.cloudera.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Comments Feed" href="http://blog.cloudera.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Cloudera Developer Blog &raquo; Process a Million Songs with Apache Pig Comments Feed" href="http://blog.cloudera.com/blog/2012/08/process-a-million-songs-with-apache-pig/feed/" />
<link rel='stylesheet' id='prettify-gc-syntax-highlighter-css'  href='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.css?ver=3.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='cptchStylesheet-css'  href='http://blog.cloudera.com/wp-content/plugins/captcha/css/style_wp_before_3.8.css?ver=3.3.2' type='text/css' media='all' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.cloudera.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.cloudera.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Cloudera Software Engineer Eli Collins on Apache Hadoop and CDH4' href='http://blog.cloudera.com/blog/2012/08/cloudera-software-engineer-eli-collins-on-hadoop-and-cdh4/' />
<link rel='next' title='Cloudera Manager 4.0.4 &amp; Cloudera Manager 3.7.8 Released!' href='http://blog.cloudera.com/blog/2012/08/cloudera-manager-4-0-4-cloudera-manager-3-7-8-released/' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='canonical' href='http://blog.cloudera.com/blog/2012/08/process-a-million-songs-with-apache-pig/' />
<link rel='shortlink' href='http://blog.cloudera.com/?p=17398' />


<script type="text/javascript">
 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-2275969-16']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();
</script>


</head>
<body class="single single-post postid-17398 single-format-standard devcenter">
			
		
			
	<header id="site-head">
<nav class="properties">
            <div class="container">
                <ul>
                    <!--<li><a href="http://www.cloudera.com">Cloudera.com</a></li>-->
                     <!--<li><a href="http://university.cloudera.com">Cloudera University</a></li>
                   <li><a href="${config.LINK_CCP}/display/DOC/Documentation">Documentation</a></li>-->
                    <li><a id="support_home_page" href="http://cloudera.com/content/support/en/home.html" class="active">Support</a></li>
                    <li><a href="http://cloudera.com/content/dev-center/en/home.html">Developers</a></li>
                  <!--<li><a href="http://cloudera.com/content/cloudera/en/partners.html">PARTNERS</a></li>-->
                   
                </ul>
                <ul class="user">
                    <li>
                       <!--<a id="signinLink" class="hidden" href="https://clouderapkb.echolane.cs3.force.com/idp/login?app=0spQ00000004CD5">Sign In</a>-->
<a id="signinLink" class="hidden" href="https://cloudera.secure.force.com">Sign In</a>
                    </li>
                    <li><a id="registerLink" class="hidden" href="http://cloudera.com/content/support/en/user-registration.html">Register</a></li>
                    <li><a href="http://cloudera.com/content/cloudera/en/about/contact-us.html">Contact Us</a></li>
                    <li><a href="http://cloudera.com/content/support/en/downloads.html">Downloads</a></li>
                    <li>
                        <div id="dropdownAction" class="dropdown" style="display:none">
                            <a id="lnkDropdowntoogle" data-toggle="dropdown" class="dropdown-toggle" href="#">

                            </a>
                            <ul aria-labelledby="dropdownMenu" tole="menu" class="dropdown-menu">
                                <li><a href="http://cloudera.com/content/support/en/edit-user-profile.html" id="editProfileLink" tabindex="-1">Edit Profile</a></li>
                                <li class="divider"></li>
                                <li>
                                <a id="logoutLink" tabindex="-1" href="#">Logout</a>
                                </script>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="bg-fix"></div>
        </nav>
<!--</div>-->

<div class="wrapper">
    <div class="bg-fix"></div>
    <h1 class="logo">
        <a href="http://cloudera.com/content/cloudera/en/home.html">Cloudera</a>
    </h1>

<nav class="site">
        <ul>
    <li class="">
 <a href="http://community.cloudera.com" data-link="external">Community</a>
</li>
<li class="">
 <a href="http://cloudera.com/content/support/en/documentation.html" data-link="external">Documentation</a>
</li>
 <li class="">
                    <a href="http://cloudera.com/content/support/en/downloads.html" data-link="external">Downloads</a>
   </li>
     <li class="">
                    <a href="http://university.cloudera.com" data-link="external">Training</a>
     </li>
<li class="">
                    <a href="http://blog.cloudera.com" data-link="external" class="active">Blogs</a>
                    <nav class="subnav menu"> <nav><ul>
<li><a href="http://vision.cloudera.com">Cloudera Vision</a></li>
<!--<li><a href="http://blog.cloudera.com/blog">Developer Blog</a></li>-->
</ul>
</nav> </nav>
</li>
            
        </ul>
    </nav>


    <div class="form-holder">
		
	    <form action="http://cloudera.com/content/cloudera/en/search.html" id="site-search" method="get" novalidate> 
	        <label for="q" class="visuallyhidden">Search</label> 
	        <input type="search" name="q" id="q" placeholder="Search"><i class="icon-search"></i> 
	    </form>
    </div>
    </div><!--</div>-->
        </header>
				
	<div role="main" class="main">
		<div class="wrapper">
			<section class="two-col">

	
<aside class="left-col">

				<nav>
			<ul class=" ">
			
								
							<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/hadoop-and-big-data.html"
					title="Hadoop &amp; Big Data"
					class=""
					target="_blank"				>
					Hadoop &amp; Big Data				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/our-customers.html"
					title="Our Customers"
					class=""
					target="_blank"				>
					Our Customers				</a>

							</li>
			
					<li class="">
				<a
					href="http://www.cloudera.com/content/cloudera/en/why-cloudera/faqs.html"
					title="FAQs"
					class=""
					target="_blank"				>
					FAQs				</a>

							</li>
			
					<li class="current">
				<a
					href="/blog/"
					title="Blog"
					class="blog"
									>
					Blog				</a>

									<ul>
									<li class="">
				<a
					href="/blog/category/accumulo/"
					title="Accumulo (1)"
					class=""
									>
					Accumulo (1)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/avro/"
					title="Avro (16)"
					class=""
									>
					Avro (16)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/bigtop/"
					title="Bigtop (6)"
					class=""
									>
					Bigtop (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/books/"
					title="Books (6)"
					class=""
									>
					Books (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/careers/"
					title="Careers (14)"
					class=""
									>
					Careers (14)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cdh/"
					title="CDH (127)"
					class=""
									>
					CDH (127)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloud-2/"
					title="Cloud (9)"
					class=""
									>
					Cloud (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-life/"
					title="Cloudera Life (3)"
					class=""
									>
					Cloudera Life (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/cloudera-manager/"
					title="Cloudera Manager (61)"
					class=""
									>
					Cloudera Manager (61)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/community/"
					title="Community (182)"
					class=""
									>
					Community (182)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-collection/"
					title="Data Collection (17)"
					class=""
									>
					Data Collection (17)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/data-science/"
					title="Data Science (26)"
					class=""
									>
					Data Science (26)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/distribution/"
					title="Distribution (36)"
					class=""
									>
					Distribution (36)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/events/"
					title="Events (37)"
					class=""
									>
					Events (37)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/flume/"
					title="Flume (18)"
					class=""
									>
					Flume (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/general/"
					title="General (327)"
					class=""
									>
					General (327)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/guest/"
					title="Guest (77)"
					class=""
									>
					Guest (77)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hadoop/"
					title="Hadoop (294)"
					class=""
									>
					Hadoop (294)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hardware/"
					title="Hardware (3)"
					class=""
									>
					Hardware (3)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hbase/"
					title="HBase (124)"
					class=""
									>
					HBase (124)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hdfs/"
					title="HDFS (45)"
					class=""
									>
					HDFS (45)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hive/"
					title="Hive (62)"
					class=""
									>
					Hive (62)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/how-to/"
					title="How-to (53)"
					class=""
									>
					How-to (53)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/hue/"
					title="Hue (30)"
					class=""
									>
					Hue (30)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/impala/"
					title="Impala (63)"
					class=""
									>
					Impala (63)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/kite-sdk/"
					title="Kite SDK (11)"
					class=""
									>
					Kite SDK (11)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mahout-2/"
					title="Mahout (5)"
					class=""
									>
					Mahout (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/mapreduce/"
					title="MapReduce (71)"
					class=""
									>
					MapReduce (71)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/meet-the-engineer/"
					title="Meet The Engineer (18)"
					class=""
									>
					Meet The Engineer (18)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/oozie/"
					title="Oozie (25)"
					class=""
									>
					Oozie (25)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/ops/"
					title="Ops And DevOps (19)"
					class=""
									>
					Ops And DevOps (19)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/pig/"
					title="Pig (35)"
					class=""
									>
					Pig (35)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/quickstart-vm/"
					title="QuickStart VM (5)"
					class=""
									>
					QuickStart VM (5)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/search/"
					title="Search (21)"
					class=""
									>
					Search (21)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/security-2/"
					title="Security (15)"
					class=""
									>
					Security (15)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/spark/"
					title="Spark (9)"
					class=""
									>
					Spark (9)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/sqoop/"
					title="Sqoop (20)"
					class=""
									>
					Sqoop (20)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/support/"
					title="Support (4)"
					class=""
									>
					Support (4)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/testing/"
					title="Testing (8)"
					class=""
									>
					Testing (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/this-month-in-the-ecosystem/"
					title="This Month In The Ecosystem (8)"
					class=""
									>
					This Month In The Ecosystem (8)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/tools/"
					title="Tools (6)"
					class=""
									>
					Tools (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/training-2/"
					title="Training (42)"
					class=""
									>
					Training (42)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/use-case/"
					title="Use Case (59)"
					class=""
									>
					Use Case (59)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/whirr/"
					title="Whirr (6)"
					class=""
									>
					Whirr (6)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/yarn/"
					title="YARN (13)"
					class=""
									>
					YARN (13)				</a>

							</li>
			
					<li class="">
				<a
					href="/blog/category/zookeeper/"
					title="ZooKeeper (24)"
					class=""
									>
					ZooKeeper (24)				</a>

							</li>
			
					<li class="">
				<a
					href="/archive/"
					title="Archives by Month"
					class=""
									>
					Archives by Month				</a>

							</li>
			
							</ul>
							</li>
			
						
			    
			
				<div style="clear:both"></div>
			</ul>
			</nav>
			<div class="menu-special">
				<ul>
							
				
				
		
				
		
				
				
				
				

		
					</ul>
			</div>
			
</aside>


<section>
			<h1 class="heading ">Process a Million Songs with Apache Pig</h1>
			
			<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
			
			<ul class="post-info">
				<li>by Adam Kawa</li>
				<li>August 21, 2012</li>
				<li class="comment"><a href="#comments">1 comment</a></li>
				
			</ul>
			
			<div class="text-block">
				<p><em>The following is a guest post kindly offered by Adam Kawa, a 26-year old Hadoop developer from Warsaw, Poland. This post was originally published in a slightly different form at his blog, <a href="http://hakunamapdata.com/">Hakuna MapData!</a></em></p>
<p>Recently I have found an interesting dataset, called <a href="http://labrosa.ee.columbia.edu/millionsong/">Million Song Dataset</a> (MSD), which contains detailed acoustic and contextual data about a million songs. For each song we can find information like title, hotness, tempo, duration, danceability, and loudness as well as artist name, popularity, localization (latitude and longitude pair), and many other things. There are no music files included here, but the links to MP3 song previews at <a href="http://www.7digital.com/" target="_blank">7digital.com</a> can be easily constructed from the data.</p>
<p>The dataset consists of 339 tab-separated text files. Each file contains about 3,000 songs and each song is represented as one separate line of text. The dataset is publicly available and you can find it at <a href="http://www.infochimps.com/collections/million-songs" target="_blank">Infochimps</a> or <a href="http://tbmmsd.s3.amazonaws.com/" target="_blank">Amazon S3</a>. Since the total size of this data sums up to around 218GB, processing it using one machine may take a very long time.</p>
<p>Definitely, a much more interesting and efficient approach is to use multiple machines and process the songs in parallel by taking advantage of open-source tools from the <a href="http://hadoop.apache.org/">Apache Hadoop</a> ecosystem (e.g. <a href="http://pig.apache.org/">Apache Pig</a>). If you have your own machines, you can simply use CDH (Cloudera&#8217;s Distribution including Apache Hadoop), which includes the complete Apache Hadoop stack. CDH can be installed manually (quickly and easily by typing a couple of simple commands) or automatically using Cloudera Manager Free Edition (which is Cloudera&#8217;s recommended approach). Both CDH and Cloudera Manager are freely downloadable <a href="https://ccp.cloudera.com/display/SUPPORT/Downloads" target="_blank">here</a>. Alternatively, you may rent some machines from Amazon with Hadoop already installed and process the data using <a href="http://aws.amazon.com/elasticmapreduce/">Amazon&#8217;s Elastic MapReduce</a> (here is <a href="http://musicmachinery.com/2011/09/04/how-to-process-a-million-songs-in-20-minutes/" target="_blank">a cool description</a> writen by Paul Lemere how to use it and pay as low as $1, and here is <a href="http://www.slideshare.net/adamkawa/elastic-mapreduce-at-whug" target="_blank">my presentation about Elastic MapReduce</a> given at the second meeting of <a href="http://whug.org">Warsaw Hadoop User Group</a>).</p>
<h2>Problem Definition</h2>
<p>I came up with the idea to process this dataset to find &#8220;exotic&#8221; (but still popular) songs. By exotic songs, I simply mean a song that is recorded by an artist who lives in some foreign country, far away from other artists. The general goal is to discover a couple of fancy folk songs that are associated with the culture of some country. A funny example could be the song <a href="http://www.youtube.com/watch?v=YtDhMzDkois&amp;feature=related">&#8220;Koko Koko Euro Spoko&#8221;</a> by Jarzêbina which was chosen by Poles to be the official song of Polish national football team during UEFA EURO 2012.</p>
<h2>Apache Pig</h2>
<p>I have used <a href="http://pig.apache.org/">Apache Pig</a> to achieve this goal. Apache Pig is a convenient tool created at Yahoo! to analyze large datasets easily and efficiently. Apache Pig provides a high level and easy to learn, understand and maintain data flow programming language, called PigLatin.</p>
<p>PigLatin is quite similar to scripting languages, it supports many useful operations like filtering, sorting, aggregation, joining, splitting and provides several complex data types (tuples, bags and maps). An exemplary PigLatin script is 20x shorter than its equivalent in Java MapReduce and takes a programmer 16x less time to implement it, at the same time being only slightly slower than Java MapReduce (see <a href="https://cwiki.apache.org/PIG/pigmix.html">PigMix2 benchmark</a>). Thanks to these advantages, Apache Pig is often used by many well-recognized companies and organizations e.g. Yahoo! (currently about 90% Hadoop jobs is written in PigLatin), Twitter, Nokia Ovi Maps, AOL, Mendeley, LinkedIn and ICM UW.</p>
<h2>PigLatin Script</h2>
<p>To find such popular folk and local songs, I have implemented a simple PigLatin script (about 50 lines of PigLatin code). This script uses a bit naive, but quite effective idea and tries to search for “isolated” songs. An isolated song is simply a song where the average distance between its artist localization and any other artists is as low as possible (to be more precise, I should say that an isolated song is a song recorded by an isolated artist). This approach gives us much bigger probability to discover “ear-catching” songs from Congo, Mali, Poland and Vietnam than from the US or the UK.</p>
<p>As mentioned, the dataset contains artists’ localization information in form of lat/long pairs and luckily there is a open-source library <a href="https://github.com/linkedin/datafu">DataFu</a> (created by LinkedIn) that provides e.g. PigLatin UDF to calculate distance between two lat/long pairs using the <a href="http://en.wikipedia.org/wiki/Haversine_formula">Haversine formula</a>.</p>
<p>I read the input data and filter out unpopular songs or songs without lat/long localization (relation <code>Filtered</code>). Then I produce all pairs of different songs (relation <code>Different</code>) and calculate distance between their artists localization (relation <code>Distanced</code>). Next, for each song, I calculate the average distance between the song’s artist localization and all other songs’ artists localization (relation <code>AvgDistanced</code>). Now, I can limit my records to take only the most interesting results. Firstly, I want to have only the hottest song for a given location (relation <code>Popular</code>). Then I remain only a small number of songs with the lowest average distance (relation <code>Limited</code>) and finally store output results in the the format that will be useful for further visualization with Google Maps (relation <code>Displayed</code>).</p>
<p>Here is the source code:</p>
<pre class="code" style="padding-left: 30px;">SET  default_parallel $parallel
SET  pig.tmpfilecompression true
SET  pig.tmpfilecompression.codec lzo
SET  pig.maxCombinedSplitSize 134217728

REGISTER '/usr/lib/pig-0.10.0/contrib/datafu-0.0.4/dist/datafu-0.0.4.jar';
DEFINE haversineMiles datafu.pig.geo.HaversineDistInMiles();

Songs = LOAD '$input';
--"Project early and often"
Projected = FOREACH Songs GENERATE
        (double) $6 AS artistLat, (double) $8 AS artistLong, $12 AS artistName,
        (double) $43 AS songHotness, $51 AS songTitle, (int) $52 AS songPreview;

--"Filter early and often"
Filtered = FILTER Projected BY (songHotness &gt;= $hotness) AND
    (artistLat IS NOT NULL) AND (artistLong IS NOT NULL);
--"Copy useful fields from Popluar relation"
Filtered2 = FOREACH Filtered GENERATE songPreview as song2Preview, artistLat AS
    artist2Lat, artistLong AS artist2Long;

--"Produce all pairs of different songs and calculate distance between localizations
   of their artists"
Crossed = CROSS Filtered, Filtered2;
Different = FILTER Crossed BY songPreview != song2Preview;
Distanced = FOREACH Different GENERATE artistLat..songPreview,
        haversineMiles(artistLat, artistLong, artist2Lat, artist2Long) as distance;

--"For each song, calculate average distance between its artists and all other artists"
Grouped = GROUP Distanced BY artistLat..songPreview;
AvgDistanced = FOREACH Grouped {
        Distances = Distanced.distance;
        GENERATE FLATTEN(group), AVG(Distances) AS distanceAvg;
}

--"Find the most popular song for a given location"
Locationed = GROUP AvgDistanced BY (artistLat, artistLong);
Popular = FOREACH Locationed {
        OrderedSongs = ORDER AvgDistanced BY songHotness DESC;
        TopSong = LIMIT OrderedSongs 1;
        GENERATE FLATTEN(TopSong);
}
--"Find the most isolated songs which were recored by artists
    who live far away from other artists"
Ordered = ORDER Popular BY distanceAvg DESC;
Limited = LIMIT Ordered $topCount;

--"Generate results in such a format that can be easily displayed
   by Google Maps (by copy &amp; paste)"
Displayed = FOREACH Limited GENERATE
        CONCAT('[', (chararray) artistLat), artistLong, songPreview,
        CONCAT('"', CONCAT((chararray) songTitle, '"')),
        CONCAT('"', CONCAT((chararray) artistName, '"')),
        songHotness,
        CONCAT((chararray)distanceAvg, '],');

STORE Displayed INTO '$output' USING PigStorage(',');
</pre>
<h3>Running PigLatin script</h3>
<p>My script takes five parameters: input and output paths, the song&#8217;s &#8220;hotness&#8221; threshold (a float number between 0.0 and 1.0), the number of output songs, and default level of parallelism.</p>
<pre class="code" style="padding-left: 30px;">time /usr/lib/pig-0.10.0/bin/pig -p input=input/million-song -p
hotness=0.5 -p topCount=200 -p parallel=100 -p
output=output/million-song/all.5.200.100 exotic-songs.pig
</pre>
<p>Pig runs this script as sequence of seven MapReduce jobs. The total time of running this script was 40m 47.758s. I have optimized this script by increasing memory available for child tasks, combining small input files, compressing the output of the map tasks and the output of the intermediate jobs using LZO compression. I have also turned off the speculative execution for both map and reduce tasks. (Note that there were no other jobs running on the Hadoop cluster at that time.)</p>
<p>I have run this script on the Hadoop cluster that belongs to <a href="http://www.icm.edu.pl/" target="_blank">ICM UW</a>. I have used three &#8220;fat&#8221; slave nodes and a virtual machine on separate machine in the role of HDFS NameNode and Hadoop JobTracker. Each worker node has four AMD Opteron 6174 processors (48 cores in total), 192GB of RAM and can store 7TB of data. For the purpose of this Pig script, I have configured each worker node to run 45 map and 35 reduce tasks maximally. (So in total, I can run 135 map and 105 reduce tasks in parallel.) I do realize that it is not typical Hadoop configuration (definitely, it is not commodity hardware), but I just simply use what I have. Currently, there is CDH3u3 installed here, which includes Hadoop 0.20.2 and Pig 0.8.1 by default. However, I have installed Pig 0.10.0 manually on my client machine and used it to submit jobs to this cluster.</p>
<p>The readability and performance of this script could be improved by implementing own user-defined functions (UDFs) e.g. multi-text concatenation, tuning some MapReduce and Pig parameters (e.g. <code>pig.maxCombinedSplitSize</code>) or setting better customized level of parallelism using <code>PARALLEL</code> keyword.</p>
<h2>The Results to See</h2>
<p>The results can be visualized by using some JavaScipt with GoogleMaps. The map below shows 200 songs, and for each song, I put a clickable marker in its artist&#8217;s lat/long localization that displays basic information about this song and the link to a song&#8217;s preview.<br />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
</p>
<div id="map" style="width: 600px; height: 600px;"> </div>
<p>
<script type="text/javascript">// <![CDATA[
var songs = [
[-32.05286,115.74824,1397626,"Black Fingernails_ Red Wine","Eskimo Joe",0.669101061464,9865.629477841067],
[-31.95302,115.85724,8997617,"Watercolour","Pendulum",0.971493887296,9860.058580049747],
[-34.92647,138.59991,7864728,"Portraits Dreams &#038; Memories","I Killed The Prom Queen",0.663752069491,9485.020484893203],
[-24.43781,121.0791,3156598,"Circulos","Gato Barbieri",0.505252102145,9470.201003562837],
[-32.0289,135.00215,1989343,"Chris Mills Is Living The Dream","Chris Mills",0.512943374669,9469.192184324851],
[-37.81753,144.96715,1139588,"Look What You've Done (Album Version)","JET",0.953240489737,9438.752736506007],
[-37.85254,145.0369,8707734,"Too Many Broken Hearts","Jason Donovan",0.557275763073,9438.386202648251],
[-37.79744,144.97012,8380909,"Shaddap You Face","Joe Dolce",0.625180536458,9438.105217138056],
[-36.36003,144.69832,1600282,"Harley Davidson","Mick Harvey",0.558891557824,9400.668365953972],
[-36.55865,145.469,3783527,"Let Me Be","Xavier Rudd",0.81103141712,9390.791139142879],
[-37.79898,147.61493,1353376,"Roller Coaster","Square One",0.518759897997,9385.267643688687],
[-36.35484,146.32611,7711841,"Get Ready For Love","Nick Cave &#038; The Bad Seeds",0.833066269649,9366.951998923574],
[-35.30654,149.12656,8581436,"Up in Beachwood","Frank Gambale",0.637210510511,9275.719303770691],
[-46.41185,168.35217,1321240,"The Invocation","Belial",0.50860217179,9266.67322021741],
[-24.9162,133.39311,7275085,"The Birds And The Bees","Jewel Akens",0.790193106089,9242.678428032075],
[-32.83102,147.31906,600559,"I'll Be There (LP Version)","The Escape Club",0.63954250385,9230.79815547028],
[-45.8745,170.50385,1280153,"Pink Frost","The Chills",0.754307748821,9212.824466794307],
[-33.87067,151.03363,449953,"Generation Nintendo","Kyle Cease",0.621621072829,9187.079237523907],
[-33.86963,151.20695,238654,"I Touch Myself","Divinyls",0.974374051,9183.351350050765],
[-33.46765,151.3815,3529066,"Lonely Carousel","Rodrigo Le?o",0.551288056021,9165.693203967428],
[-43.58771,170.36664,5162630,"Sleepwalker","Sola Rosa",0.646540734832,9137.074219421489],
[-43.53131,172.6373,228238,"Dark Waltz","Hayley Westenra",0.826482803776,9090.930354850743],
[-41.28054,174.76714,8378845,"They Don't Want","Electric Wire Hustle",0.837114556815,8960.028812970355],
[-27.46888,153.02283,3253717,"Insatiable","Darren Hayes",0.716514296094,8905.91695697013],
[-26.39902,153.0861,3958819,"Night Shift","The Names",0.52670665927,8862.103166022016],
[-38.00964,175.31923,12359,"She Will Have Her Way","Neil Finn",0.707782974847,8813.557230946595],
[-37.89306,175.47131,5101665,"Harmonic Generator","The Datsuns",0.691337556282,8805.01985913831],
[-37.06542,174.94392,2365288,"In The Morning (Album)","Anika Moa",0.518759897997,8782.866319894529],
[-36.88411,174.77042,24397,"Walkie Talkie Man","Steriogram",0.716036977123,8779.404299571563],
[-36.19442,175.4266,1280728,"What I Want","The D4",0.503381236206,8734.084492112574],
[-6.17144,106.82782,585067,"Puttin' On The Ritz","Taco",0.903618146768,8721.032478208374],
[-0.91754,119.85946,8349150,"Issa","Manual",0.512390375313,8337.487288926543],
[1.32026,103.78871,438618,"Screwed (Album Version)","Paris Hilton",0.813948890007,8304.359772111333],
[1.36558,103.82771,1551050,"Storm","Vanessa-Mae",0.748565507462,8301.782962793854],
[2.99042,101.48481,7097858,"Art Of Love","Guy Sebastian",0.676419126969,8205.9867239233],
[-33.96243,25.62326,442356,"Moon River","Danny Williams",0.73538587253,8009.277431587426],
[-26.20494,28.04003,3155741,"Theme From Armageddon","Trevor Rabin",0.859013045373,7782.684497472493],
[-26.24875,27.84378,3838862,"What's Wrong With Groovin'","Letta Mbulu",0.692026453363,7777.050024695767],
[10.75918,106.6625,4869053,"Pandi panda","Chantal Goya",0.595280456422,7763.722417247445],
[-33.93333,18.51667,3988174,"Vuli Ndlela - (Original Album Version)","Brenda",0.589061402029,7753.344605753394],
[-28.48322,24.67699,5336619,"Scatterlings of Africa (Remix)","Johnny Clegg &#038; Juluka",0.556014354419,7752.105933723997],
[-28.483219,24.676991,7185876,"Sooner Or Later","The Grassroots",0.740039541069,7752.105929044194],
[14.56298,121.02183,1756471,"Ikaw Pala","Sugarfree",0.542307526169,7481.7604483278255],
[13.05939,80.24567,4260370,"Jiya Jale (from the film 'Dil Se')","AR Rahman",0.527703314056,7401.047280641774],
[-22.96566,18.48617,7845754,"Heaven Scent","Bedrock",0.727694916099,7281.814046215102],
[-6.16591,39.20264,274539,"The Great Pretender (Original Single Version) (2000 Digital Remaster)","Freddie Mercury",0.719043726998,7265.098980783539],
[-13.15192,27.85254,4179661,"Everybody's Free","Rozalla",0.822924563197,7177.885607846988],
[22.25769,113.9378,7343247,"Life On The Road (Live At The Roundhouse 24/6/73)","Man",0.505025446262,7089.956420125525],
[22.41125,114.15354,8281837,"Follow Me","Amanda Lear",0.682842046326,7080.419449031039],
[21.7866,82.79476,1298046,"FALLEN DOWN","Assemblage 23",0.702406533882,6931.689511674582],
[23.68745,90.3509,2577378,"Chandra Dhani (Alap)","Ali Akbar Khan",0.506270993523,6919.752869238677],
[19.07619,72.87588,6173182,"Cherry Town","Trilok Gurtu",0.619231168877,6906.888776736992],
[25.02698,121.49713,7859445,"Warfare","Zyklon-B",0.590433424828,6891.642611968447],
[25.06634,121.53189,5392394,"Cornerstone Of Misery","The Amity Affliction",0.738361779104,6889.169008012595],
[-3.38791,29.92039,5867241,"Mama","Khadja Nin",0.536913114695,6774.084598822555],
[26.47499,127.98211,6807594,"Kirikirimai (Fantastic Four Remix)","Orange Range",0.548678055568,6752.1307453071695],
[-1.9501,30.05877,317261,"Sometime Later","Alpha",0.652615539161,6706.493180354882],
[0.3228,32.57484,3322504,"The Pod","HUM",0.6785238284,6684.372808875571],
[22.44608,69.9077,4791754,"Fonz","Eugene McGuinness",0.583005621113,6647.546753537694],
[1.36519,32.30465,6874723,"Tu Si Quieres_ Tu No Quieres","Omega",0.611214622611,6620.803468416054],
[27.13844,80.86235,696571,"Dancing Drums","Ananda Shankar",0.63602372747,6588.814450302425],
[27.57452,78.30813,7183849,"Kala Djula","Ali Farka Touré_ Toumani Diabaté",0.661054995145,6520.380114698823],
[9.1473,40.49305,6891789,"Yegelle tezeta","Mulatu Astatke",0.758350586628,6510.109971401851],
[-4.03479,21.75627,314794,"Yolele","Papa Wemba",0.610370247756,6501.2385265551275],
[12.80095,45.03352,7273933,"The Tyranny of Ducks","Eddie Izzard",0.68477145808,6470.973675281485],
[31.5909,130.65604,3283252,"HEAVY METAL THUNDER","SEX MACHINEGUNS",0.519448581494,6439.661976038872],
[35.85683,129.2459,6349086,"Bad Choices","Shout Out Out Out Out",0.600582218726,6218.504437891616],
[34.67747,135.50323,3870648,"Hurry Xmas","L'Arc~en~Ciel",0.772397196453,6211.513892644684],
[-37.0907,-63.58481,2474379,"Mi Enfermedad","Los Rodriguez",0.752312507139,6203.532082341405],
[36.44815,127.85017,1152279,"To The Mountains","Bigbang",0.664698636151,6198.96866917583],
[35.00476,135.70743,6608013,"Trouble Sleeping (Album Version)","The Perishers",0.823628742802,6191.057964169892],
[35.09813,135.71893,2373290,"Belinda May (edit)","Fantastic Plastic Machine",0.56974732263,6185.844332967062],
[35.33239,136.28712,1098466,"Grown Ups","Wreckless Eric",0.513213953506,6165.758251954986],
[-36.42218,-71.95566,4561608,"Volver a los 17","Violeta Parra",0.62830343443,6156.992043207416],
[37.55712,126.97738,2478384,"Lost (Clean)","Cool Calm Pete",0.642237671144,6144.881961808184],
[37.65863,126.7378,5718106,"Everything Is Everything","Black Diamond Heavies",0.523075535851,6141.25140698486],
[-34.8809,-56.16544,1340365,"Todo se transforma","Jorge Drexler",0.79463953702,6116.6294524788955],
[-35.70522,-71.34109,1686604,"Felicidad","Gondwana",0.64727218019,6114.869706733639],
[35.63649,139.63449,2082194,"Count Five Or Six","CORNELIUS",0.641923946651,6103.239986827603],
[35.67048,139.74092,2235635,"Les Gens Parlent","Bijou",0.754264508501,6099.880991999279],
[-34.60852,-58.37354,387078,"Missing You","Chris De Burgh",0.809354214709,6086.110985299861],
[37.4876,139.83829,3043992,"Left Behind","CSS",0.83509041196,6001.328816162313],
[5.87522,-162.4365,7585714,"I Remember When","Eldar",0.537503904192,5999.245644790906],
[-33.46304,-70.64794,6382861,"Funky Little Beat","Connie",0.754831189702,5984.799736072585],
[-32.95456,-60.65649,3158680,"Straight Into The Sunrise","Gato Barbieri",0.683943486504,5979.721959576215],
[-33.04269,-71.37585,6341519,"Loca","Chico Trujillo",0.693366890107,5960.851331800439],
[-32.89123,-68.83955,379593,"Mi Primer Dia Sin Ti","Los Enanitos Verdes",0.587426506702,5952.196025418647],
[33.93045,67.67894,1357365,"Shining Star (Pornocult Vocal Mix)","Get-far",0.724092103675,5946.711426753612],
[15.59092,32.51883,2936821,"Azara Al Hay","Rasha",0.547735296798,5889.025907796814],
[37.59791,69.86799,3322568,"On The Rebound","Floyd Cramer",0.774373226444,5788.920319779689],
[32.42065,53.68236,2703928,"Blow Up The Embassy","Fearless Iranians From Hell",0.508579496274,5677.193031377833],
[-22.97673,-43.19508,328539,"Beb?","Eumir Deodato",0.593423774006,5609.335006861142],
[-23.6361,-46.71173,5607307,"Triste Bahia","Caetano Veloso",0.665473687973,5593.499472468648],
[-23.56287,-46.65466,3341449,"Call Me","Eliane Elias",0.695378645668,5590.296799812173],
[-19.59634,-40.77105,3421019,"Es Por Ti","Cómplices",0.717141363013,5468.28832519322],
[35.70259,51.40883,1165470,"Last One","Aril Brikha",0.734653701178,5438.807141802018],
[-23.64126,-70.39938,1745677,"Henry The 8th","Army of the Pharoahs",0.575511786732,5417.368356682793],
[6.82323,5.67481,2676191,"Ja Funmi","King Sunny Ade",0.712380414557,5392.030249729493],
[9.08457,8.67425,7688976,"Da Doo Ron Ron","The Crystals / La La Brooks",0.708453344548,5381.721593229377],
[6.43918,3.42348,5771921,"By Your Side","Sade Adu",0.838591952324,5335.9778328774155],
[-20.61711,-54.54294,532283,"Farewell Is A Lonely Sound","Jimmy Ruffin",0.760307383572,5333.373520883403],
[7.37884,3.89527,3103808,"Smooth Operator","Sade",0.945866108953,5305.408260013721],
[26.69636,30.24647,6512912,"Tiny Meat","Ruby",0.579728748614,5234.491186193456],
[31.3893,35.36124,626186,"Lay Your Head Down","Keren Ann",0.780096719324,5165.5283725744775],
[-12.97002,-38.50456,1119701,"Berimbau Metalizado","Ivete Sangalo",0.812852813071,5161.320257853874],
[9.32204,2.31313,5386160,"Concerto","Tame One",0.513517028537,5158.610084659023],
[-15.77564,-47.79675,4709964,"Copycat (Belgium)","Copycat",0.556395557183,5152.324495555807],
[-15.77846,-47.92866,3532971,"The Storm Is Over Now","Gods Property",0.633197379188,5150.559391217369],
[-15.6245,-47.67101,5415027,"Abusadora","Wilfrido Vargas",0.677390429094,5146.029615102228],
[-13.442,-41.9952,5868190,"Losing Friends","Death From Above 1979",0.754655858205,5121.688912015308],
[7.95501,-1.03182,16166,"Say How I Feel","Rhian Benson",0.576399981255,5118.011342270867],
[22.07709,-159.3171,219341,"Fire Fe The Vatican","Max Romeo",0.508289105968,5114.18662284657],
[32.0451,34.76971,8228832,"Smash","Avishai Cohen",0.698973058024,5112.814212447702],
[19.65,-155.994,6010672,"So Over You","The Mission District",0.552188372908,5099.958501635068],
[30.08374,31.25536,6955,"She Blinded Me With Science","Thomas Dolby",0.835194036079,5095.703703995928],
[21.30473,-157.85762,24267,"If I Can't Have You","Yvonne Elliman",0.888323307334,5094.668203987279],
[21.34765,-157.7197,9039115,"Hilo E / E Lili'u E","Cyril Pahinui_ Bob Brozman",0.597116702923,5087.546178376638],
[19.59009,-155.43414,6807380,"Eyes Wired Shut","Edgewater",0.832589090651,5081.459661986362],
[6.65512,-4.71976,347376,"Scody (Part I)","Erik Truffaz",0.613854458904,5065.732557660507],
[33.89275,35.48527,3428404,"I Like Chopin","Gazebo",0.705840756297,5043.241074419117],
[-9.82491,-36.74328,5132643,"Mixing Pot (Tacho) (LP Version)","Hermeto Pascoal",0.537291103453,5034.0142945579755],
[31.19224,29.88987,228604,"Forever And Ever","Demis Roussos",0.664610055025,4994.198464519678],
[-14.24292,-54.38783,2199845,"Beautiful Life","Gui Boratto",0.852151131163,4982.973559777131],
[59.46148,108.83178,9045225,"Eli_ Eli (A Walk To Caesarea)","Sophie Milman",0.650946592075,4967.962336215817],
[17.61099,8.08094,7553812,"Tadieu Bone","Ismaël Lô",0.65356112977,4941.227041378134],
[-12.69524,-55.92844,5646257,"Amado","Vanessa Da Mata",0.753724376924,4881.4859988283015],
[38.95774,35.4317,8735805,"Bu Yagmurlar","Emre Aydin",0.654186343224,4791.887813337235],
[-12.0436,-77.02122,2815576,"Maria Lando","Susana Baca",0.616850823124,4750.5975080257485],
[39.94293,32.86048,1081949,"Redemption Song","Joe Strummer",0.731105434429,4662.841907337997],
[-10.40633,-77.23871,3478762,"I'm Comin'","Silkk The Shocker",0.72242349534,4656.2012090631815],
[-9.18134,-75.00236,3225493,"Se Me Olvidó","Gian Marco",0.635063109143,4582.52875490884],
[35.46234,23.82298,2169393,"New Direction","David &#038; The Citizens",0.56414458435,4582.0496280566085],
[17.57975,-3.99883,587276,"Cler Achel","Tinariwen",0.659022828599,4563.991430335619],
[41.04085,28.98618,3915916,"Sözlerimi Geri Alamam","Bulutsuzluk Özlemi",0.589405067984,4487.052183510262],
[41.16399,28.96406,2641953,"One More Cup Of Coffee","Sertab Erener",0.66632553082,4480.65917026208],
[37.97615,23.73641,750169,"Keravnos Kivernitos","Rotting Christ",0.774344805255,4458.86154952162],
[37.04292,22.11144,3313665,"One Man's Dream","Yanni",0.819971507865,4449.912172563574],
[14.49945,-14.44555,5179364,"La belle et le bad boy","MC Solaar",0.721548783953,4408.541673466614],
[39.37413,22.95775,551582,"Conquest Of Paradise","Vangelis",0.85297371974,4367.908191349639],
[39.07245,21.84556,699678,"Anita","Costa Cordalis",0.628911350705,4345.767888259367],
[40.63955,22.93707,7714377,"Mercenary Man","Firewind",0.697993469816,4309.093810733672],
[42.7316,25.48312,5402997,"Wind feat. Yukimi Nagano","Sleep Walker",0.537536765581,4297.371364554262],
[35.9125,14.5018,7669546,"Suzanne","Moose",0.576810825333,4257.874892629789],
[35.90209,14.44812,3803593,"Not In A Million Lovers","Beangrowers",0.525961363697,4256.6690615555735],
[28.02688,1.65284,5902539,"Alkher Illa Doffor: The Nectar Remix","Cheb i Sabbah",0.634914267366,4239.659071007874],
[48.38288,31.17344,6478328,"Malanka","Haydamaky",0.520370304282,4233.487220441669],
[33.79502,9.56154,8888695,"Words","F.R. David",0.721480307444,4204.343975981739],
[37.51146,15.06744,2468610,"lattenmessen","Kettcar",0.685960728529,4200.510453625756],
[41.15265,20.17001,2936808,"Tea In Marrakech","Hamid Baroudi",0.591754160596,4196.341184310986],
[39.0812,17.1229,1600944,"Sorella Mia","Sergio Cammariere",0.521275807365,4192.950343315763],
[45.94695,24.9804,8989305,"That's My Name (Album Version)","Akcent",0.806628690963,4142.202387092541],
[55.75687,37.6151,5597569,"Better","Regina Spektor",0.866022714309,4127.334381240891],
[44.81187,20.46414,696306,"Michaela","Bata Illic",0.618885126263,4045.9173808198984],
[40.75,14.52689,4261918,"Passione","Neffa",0.529468533345,4034.4348932384214],
[40.8399,14.25185,178652,"Winter Wonderland","Patrizio Buanne",0.688341475895,4021.7527793313498],
[43.8586,18.4295,5223189,"Mjesto Za Dvoje","Letu Stuke",0.58860536878,4021.4219638683203],
[40.82186,14.12208,4036080,"Cantastorie","Corde Oblique",0.622450252994,4018.504511576309],
[43.50698,16.44171,5465621,"GOOD MORNING feat. Monique Bingham","Karizma",0.578945735111,3973.3021676608896],
[45.28303,18.80032,6987169,"A Ti Jos Places","Majke",0.528619509991,3973.155238478336],
[41.45064,12.62459,4854316,"Don't Take It (Thomos Edit)","Armando feat. Sharvette",0.566339489582,3943.8434795240505],
[41.90311,12.49576,3449575,"Rimmel","Francesco De Gregori",0.68804912695,3919.7258221460716],
[47.16116,19.50496,8352500,"Were You Thinking Of Me?","Yonderboi",0.781388209139,3919.3036987947885],
[4.86632,-58.93826,3512773,"Electric Avenue","Eddy Grant",0.820667756608,3905.5721584199764],
[42.50172,12.88512,3362268,"Ancora Tu","Lucio Battisti",0.6882805317,3905.3071875687683],
[42.50382,12.57347,618419,"Primavera","Ludovico Einaudi",0.923893070419,3895.583987387861],
[49.69475,21.76223,7665922,"Spheres Of Madness","Decapitated",0.86532229115,3893.0305493152237],
[47.50622,19.06482,4264993,"Just like","Beat Dis",0.538540415919,3891.8614543174267],
[36.78865,3.04822,220791,"Hayati","Souad Massi",0.674080222962,3875.7260505591494],
[43.71371,13.22305,5393990,"Donna Famosa","Fabri Fibra",0.526837034063,3863.5932063414693],
[45.80726,15.9676,1897469,"Bosnia By Bus","Radikal Dub Kolektiv",0.54744461584,3862.0593133287316],
[43.09798,11.78532,2218300,"Il liberismo ha i giorni contati","Baustelle",0.58761332119,3845.922078177907],
[43.4658,12.23545,244438,"Guess You Didn't Know","One Way / Al Hudson",0.639145637928,3843.833846214147],
[4.11641,-72.95853,2562390,"La Cortina","La Sonora Dinamita",0.595242498277,3830.576584643548],
[50.06007,19.93259,1668944,"Bracka","Grzegorz Turnau",0.73329186131,3823.2035926317694],
[48.14432,17.5141,1490279,"Wrong Side Of The Grave","BENEDICTION",0.575056050109,3818.62540436321],
[46.14694,14.95505,7031686,"The Prophet","Gramatik",0.599370453796,3816.653061921353],
[59.93274,30.30672,2752480,"Chm Sym for Strs_ Op.110a: Allegro: Attacca","Dmitri Shostakovich",0.730387060034,3807.0855121105997],
[43.78237,11.25499,492925,"Lasciala andare","Irene Grandi",0.56857533165,3800.6853354048603],
[45.65065,13.76709,1559150,"Sun Bay","Enrico Rava",0.509640965552,3799.803622514382],
[4.65637,-74.11779,5779856,"Bolero Falaz","Aterciopelados",0.777368981562,3797.1337654107965],
[45.8089,13.52504,6852358,"Dancing","Elisa",0.789144906343,3785.9120242763715],
[44.2193,11.31429,3349626,"Non Son Degno Di Te","Gianni Morandi",0.599370453796,3784.015327042534],
[52.23535,21.00939,1654155,"To My_ Niechciani","Molesta Ewenement",0.536612582769,3781.4577296162824],
[48.20254,16.3688,3529442,"Der Kommissar","Falco",0.711869820574,3780.6789888943485],
[52.23813,20.97151,2622763,"Nocturne in C# minor","Frederic Chopin",0.638297906423,3780.230938395603],
[47.4101,15.26854,8856543,"Nie Mehr Allein","Christian Anders",0.588040088338,3776.6763345457302],
[55.17396,23.89439,5423224,"Nebijok","Jurga",0.503752061361,3773.613674503638],
[45.43825,12.31849,2421480,"Groovejet (If This Ain't Love) (Radio Edit) (feat. Sophie Ellis-Bextor)","Spiller",0.834857864177,3763.987196173451],
[44.72979,11.08014,588143,"Music Is My Hot_ Hot Sex (Album)","CSS",0.893312554578,3755.655474029297],
[44.54187,10.78142,135812,"Laura non c'?","Nek",0.778633842454,3754.521980389533],
[44.13378,10.01671,5472358,"L'Italiano","Toto Cutugno",0.657979227969,3748.9277317733804],
[56.87546,24.6075,8889386,"Son of the Mare","Skyforger",0.592400527408,3744.170462908468],
[44.69559,10.64121,2748674,"Curami","CCCP - Fedeli Alla Linea",0.536992403893,3743.9447292976292],
[6.47279,-66.58904,3102728,"Near Miss","System",0.576399981255,3739.1960953891685],
[51.91892,19.1343,6042930,"Devilizer","Vader",0.783458914463,3735.350868842947],
[45.16433,10.79509,3612549,"Change In Nature","Operahouse",0.546093719376,3729.200092530475],
[46.82811,12.76847,4434244,"Edlnugat","Tube Control",0.560998503213,3722.191440973957],
[47.69651,13.34577,5596690,"Rhythm Of The Tides","Gandalf",0.714728372426,3706.389561883294],
[6.23651,-75.59028,339869,"La Camisa Negra","Juanes",0.829072531969,3706.1109542553368],
[63.22945,29.33181,4789374,"Puhu äänellä jonka kuulen","Happoradio",0.751664276475,3703.2024472926355]
];
var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 3,
      center: new google.maps.LatLng(0, 0),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
var infowindow = new google.maps.InfoWindow();
var marker, i;
for (i = 0; i < songs.length; i++) {  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(songs[i][0], songs[i][1]),
        map: map
      });
google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent('<a href=http://previews.7digital.com/clips/34/' + songs[i][2] + '.clip.mp3 target="_blank">' + songs[i][3] + ' by ' + songs[i][4] + '</a><br />Song Hotness: ' + songs[i][5] + '<br />Average Distance: ' + songs[i][6]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }
// ]]&gt;</script>
</p>
<h2>The Results to Hear</h2>
<p>Here are some songs that attracted my attention:</p>
<h4><em>Africa</em></h4>
<ul>
<ul>
<li><a href="http://previews.7digital.com/clips/34/587276.clip.mp3" target="_blank">Cler Achel by Tinariwen (Mali)</a> (hotness: 0.6590)</li>
<li><a href="http://previews.7digital.com/clips/34/314794.clip.mp3" target="_blank">Yolele by Papa Wemba (Democratic Republic of the Congo)</a> (hotness: 0.6103)</li>
<li><a href="http://previews.7digital.com/clips/34/3103808.clip.mp3" target="_blank">Smooth Operator by Sade (Nigeria)</a> (hotness: 0.9458)</li>
</ul>
</ul>
<h4><em>Asia</em></h4>
<ul>
<ul>
<li><a href="http://previews.7digital.com/clips/34/6173182.clip.mp3" target="_blank">Cherry Town by Trilok Gurtu (India)</a> (hotness: 0.6192)</li>
<li><a href="http://previews.7digital.com/clips/34/4869053.clip.mp3" target="_blank">Pandi panda by Chantal Goya (Vietnam)</a> (hotness: 0.5952)</li>
</ul>
</ul>
<h4><em>South America</em></h4>
<ul>
<ul>
<li><a href="http://previews.7digital.com/clips/34/339869.clip.mp3" target="_blank">La Camisa Negra by Juanes (Colombia)</a> (hotness: 0.8290)</li>
<li><a href="http://previews.7digital.com/clips/34/3512773.clip.mp3" target="_blank">Electric Avenue by Eddy Grant (Guyana)</a> (hotness: 0.8206)</li>
<li><a href="http://previews.7digital.com/clips/34/1340365.clip.mp3" target="_blank">Todo se transforma by Jorge Drexler (Uruguay)</a> (hotness: 0.7946)</li>
<li><a href="http://previews.7digital.com/clips/34/5415027.clip.mp3" target="_blank">Abusadora by Wilfrido Vargas (Brasil)</a> (hotness: 0.6773)</li>
</ul>
</ul>
<h4><em>Europe</em></h4>
<ul>
<li><a href="http://previews.7digital.com/clips/34/135812.clip.mp3" target="_blank">Laura non c&#8217;? by Nek (Italy)</a> (hotness: 0.7786)</li>
<li><a href="http://previews.7digital.com/clips/34/1668944.clip.mp3" target="_blank">Bracka by Grzegorz Turnau (Poland)</a> (hotness: 0.7332)</li>
</ul>
<p>If you find more interesting examples, just let me know or simply put them in the comments bellow. I do realize that my music taste can be questionable ;)</p>
<h2>Special Thanks</h2>
<p>Since all my calculations were performed on the Hadoop cluster that belongs to <a href="http://www.icm.edu.pl/" target="_blank">ICM UW</a>, I would like to give big thanks to the ICM&#8217;s staff for the opportunity to use the cluster. </p>
<p><em>Thanks, Adam!</em></p>

				<div class="social-buttons">
<span class='st_facebook_large' displayText='Facebook'></span>
<span class='st_twitter_large' displayText='Tweet'></span>
<span class='st_linkedin_large' displayText='LinkedIn'></span>
<span class='st_googleplus_large' displayText='Google +'></span>
<span class='st_email_large' displayText='Email'></span>
				</div>
			</div>

			<div class="grid_2" style="margin:0">
  <div class="comments comments-2">
    <div class="field-under">
      <h4>Filed under:</h4>
      <ul class="post-categories">
	<li><a href="http://blog.cloudera.com/blog/category/cdh/" title="View all posts in CDH" rel="category tag">CDH</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/community/" title="View all posts in Community" rel="category tag">Community</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/mapreduce/" title="View all posts in MapReduce" rel="category tag">MapReduce</a></li>
	<li><a href="http://blog.cloudera.com/blog/category/pig/" title="View all posts in Pig" rel="category tag">Pig</a></li></ul>  	</div>
  	
  <a name="comments"></a>
  <div class="comments-head">
    <strong>1 Response</strong>
   
  </div>
  <ul class="comments-list">
  	<li>
		<em class="comment-date">
			<a rel="nofollow" href="">Crucialfelix</a> /
			December 19, 2012 / 3:20 PM		</em>
		<p>Great article and incidentally great music selection.  I needed to learn me some pig.</p>
<p>Eddy grant is really a UK artist and I think electric avenue is in Brixton.  I guess he was born in Guyana tho.</p>
	</li>
</li>
  </ul>
  <a name="leave-comment"></a>
  <form action="/wp-comments-post.php" method="POST">
  	<div class="comment-form">
  		<h4>Leave a comment</h4>
  		<div class="row">
  			<input type="text" value="" class="txt" name="author"/>
  			<label>Name <span>required</span></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="email"/>
  			<label class="published">Email <span>required</span> <em>(will not be published)</em></label>
  		</div>
  		<div class="row">
  			<input type="text" value="" class="txt" name="url"/>
  			<label>Website</label>
  		</div>
  		<div class="row">
  			<textarea rows="10" cols="30" class="area" name="comment"></textarea>
  			<label>Comment</label>
  		</div>
  		<fieldset>
  			<input type="button" value="Leave Comment" class="btn cta"/>
  		</fieldset>
  	</div>
  	<input type='hidden' name='comment_post_ID' value='17398' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
  	<p class="cptch_block"><label>Prove you're human!<span class="required"> *</span></label><br />		<input type="hidden" name="cptch_result" value="bnc=" />
		<input type="hidden" name="cptch_time" value="1398162844" />
		<input type="hidden" value="Version: 2.4" />
		3 &minus; <input id="cptch_input" type="text" autocomplete="off" name="cptch_number" value="" maxlength="2" size="2" aria-required="true" required="required" style="margin-bottom:0;display:inline;font-size: 12px;width: 40px;" /> =  z&#101;&#114;o	</p>  </form>
</div></section>




<!-- Google Code for New Remarketing Pixel -->
<!-- Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. For instructions on adding this tag and more information on the above requirements, read the setup guide: google.com/ads/remarketingsetup -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 1035979479;
var google_conversion_label = "xel9CJ-P0QMQ15X_7QM";
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>

<noscript>
<div style="display:inline;"> <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1035979479/?value=0&label=xel9CJ-P0QMQ15X_7QM&guid=ON&script=0"/> </div>
</noscript>
</section>
<span class="bg-fix"></span>
</div>
</div>
<footer id="global-footer">
<div class="footerContent parbase">
<footer>
  <div class="wrapper">
    <div class="bg-fix"></div>
    <nav>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/products-and-services.html">Products</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products/cloudera-enterprise.html">Cloudera Enterprise</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-express.html">Cloudera Express</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-enterprise/cloudera-manager.html">Cloudera Manager</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cdh.html">CDH</a></li>
        <li><a href="http://www.cloudera.com/content/support/en/downloads.html">All Downloads</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/products-and-services/professional-services.html">Professional Services</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/training.html">Training</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/solutions.html">Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/enterprise-solutions.html">Enterprise Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/partner.html">Partner Solutions</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/solutions/industries.html">Industry Solutions</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/partners.html">Partners</a></li>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/resources/library.html">Resource Library</a></li>
        <li class="section"><a href="https://ccp.cloudera.com/display/SUPPORT/Get+Support">Support</a></li>
      </ul>
      <ul>
        <li class="section"><a href="http://www.cloudera.com/content/cloudera/en/about.html">About</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/hadoop-and-big-data.html">Hadoop &amp; Big Data</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/management.html">Management Team</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/board.html">Board</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/events.html">Events</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/press-center.html">Press Center</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/careers.html">Careers</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/about/contact-form.html">Contact Us</a></li>
        <li><a href="http://www.cloudera.com/content/cloudera/en/subscription-center.html">Subscription Center</a></li>
      </ul>
      <div class="locale-and-social" style="float:right">
        <div>
          <div class="locale-and-social">
            <div class="locale">
              <select onchange="this.options[this.selectedIndex].value &amp;&amp; (window.location = this.options[this.selectedIndex].value);" class="site-language">
                <option value="http://www.cloudera.com" name="English">English</option>
                <option value="http://www.cloudera.co.jp/">Japanese</option>
              </select>
            </div>
            <div class="social"><span class="follow">Follow us:</span><span class="share">Share:<i class="icon-share"></i></span>
              <ul>
                <li><a class="linkedIn" target="_blank" href="http://www.linkedin.com/company/cloudera">LinkedIn</a></li>
                <li><a class="twitter" target="_blank" href="http://twitter.com/cloudera">Twitter</a></li>
                <li><a class="facebook" target="_blank" href="http://www.facebook.com/cloudera">Facebook</a></li>
                <li><a class="youtube" target="_blank" href="http://www.youtube.com/user/clouderahadoop">YouTube</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <nav class="global-footer"><span class="logo"><a>Cloudera</a></span>
      <address>
      <span>Cloudera, Inc.</span> <span><a target="_blank" href="http://www.google.com/maps?q=1001+Page+Mill+Rd,+Palo+Alto,+CA+94306">1001 Page Mill Road Bldg 2</a></span> <span>Palo Alto, CA 94304</span>
      </address>
      <address>
      <span><a href="http://www.cloudera.com">www.cloudera.com</a></span> <span>US: 1-888-789-1488</span> <span>Intl: 1-650-362-0488</span>
      </address>
      <div class="copyright"><span><span class="piped">©2014 Cloudera, Inc. All rights reserved</span><span class="piped"><a href="http://www.cloudera.com/content/cloudera/en/terms-of-service.html">Terms &amp; Conditions</a></span><a href="http://www.cloudera.com/content/cloudera/en/privacy-policy.html">Privacy Policy</a></span> <span>Hadoop and the Hadoop elephant logo are trademarks of the <a target="_blank" href="http://www.apache.org/">Apache Software Foundation</a>.</span></div>
    </nav>
  </div>
</footer>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/prettify.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://blog.cloudera.com/wp-content/plugins/prettify-gc-syntax-highlighter/launch.js?ver=3.3.2'></script>
<div class="modal" style="display:none">
  <div id="password-required">
    <div class="inner"> </div>
  </div>
</div>
<div class="tooltip" class="tooltip" style="display:none">
</div>
<script type="text/javascript" src="http://dnn506yrbagrg.cloudfront.net/pages/scripts/0011/2160.js"></script>
<script type="text/javascript">var _kiq = _kiq || [];</script> 
<script type="text/javascript" src="http://s3.amazonaws.com/ki.js/14646/2Sr.js" async></script>
</body></html>
